<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0F0F0F" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/logoeventraze192x192.png" type="image/png" />
    <title>Eventraze</title>
    <link rel="stylesheet" href="assets/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="manifest" href="#" id="manifest-placeholder">
    <meta name="theme-color" content="#0F0F0F">
    <style>
        :root {
            --primary: #0F0F0F;
            --secondary: #F7C566;
            --bg-light: #FFFFFF;
            --bg-dark: #1A1A1A;
            --text-light: #333333;
            --text-dark: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-light);
            color: var(--text-light);
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        body.dark-mode {
            background: var(--bg-dark);
            color: var(--text-dark);
        }

        h1, h2, h3, h4, h5, h6, .btn {
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: var(--secondary);
            border: none;
            color: var(--primary);
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #e6b855;
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* Navigation Bar */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--primary);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .dark-mode .bottom-nav {
            background: #000000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #888;
            text-decoration: none;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--secondary);
        }

        /* Page Container */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Auth Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background:
                linear-gradient(
                    rgba(0, 0, 0, 0.5),
                    rgba(0, 0, 0, 0.5)
                ),
                url("assets/5.png");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            padding: 20px;
        }

        .auth-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }

        .dark-mode .auth-card {
            background:rgba(42, 42, 42, 0.95);
        }

        .auth-logo h1 {
            color: var(--primary);
            text-align: center;
        }

        .dark-mode .auth-logo h1 {
            color: var(--secondary);
        }

        .auth-logo p {
            color: #666;
            text-align: center;
        }
        .dark-mode .auth-logo p {
            color: #999;
        }

        /* Home Page */
        .header-section {
            background: linear-gradient(135deg, var(--primary) 0%, #2a2a2a 100%);
            color: white;
            padding: 30px 20px 20px;
            border-radius: 0 0 30px 30px;
            margin-bottom: 20px;
        }

        .greeting h2 {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .greeting p {
            opacity: 0.8;
            font-size: 14px;
        }

        /* Megaphone Animation */
        .megaphone-container {
            text-align: center;
            padding: 20px;
            height: 150px;
        }

        .megaphone {
            font-size: 80px;
            display: inline-block;
            animation: shake 2s ease-in-out infinite;
        }

        @keyframes shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }

        /* Categories */
        .categories-slider {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 20px;
            scrollbar-width: none;
        }

        .categories-slider::-webkit-scrollbar {
            display: none;
        }

        .category-card {
            min-width: 120px;
            padding: 20px;
            background: linear-gradient(135deg, var(--secondary) 0%, #e6b855 100%);
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-card i {
            font-size: 32px;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        /* Video Slider */
        .video-slider-container {
            padding: 0 20px 20px;
            overflow: hidden;
        }

        .video-slider {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            scroll-behavior: smooth;
            scrollbar-width: none;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 10px;
        }

        .video-slider::-webkit-scrollbar {
            display: none;
        }

        .video-card-youtube {
            min-width: 300px;
            width: 300px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            background: #000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .video-card-youtube iframe {
            width: 100%;
            height: 200px;
            border: none;
        }

        .video-card-youtube .video-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 15px;
            color: white;
        }

        .video-card-youtube .video-overlay h6 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .video-card-youtube .video-overlay small {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Event Cards Grid - E-commerce Style */
        .events-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 0 20px 20px;
        }

        @media (min-width: 768px) {
            .events-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
        }

        @media (min-width: 1024px) {
            .events-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                max-width: 1400px;
                margin: 0 auto;
                padding: 0 40px 20px;
            }
        }

        .event-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .dark-mode .event-card {
            background: #2a2a2a;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Image Wrapper - Portrait Style untuk tidak memotong gambar */
        .event-image-wrapper {
            position: relative;
            width: 100%;
            padding-top: 140%; 
            overflow: hidden;
            background: #f5f5f5;
        }

        .event-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .event-content {
            padding: 12px;
        }

        .event-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--text-light);
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .dark-mode .event-title {
            color: var(--text-dark);
        }

        .event-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 11px;
            color: #666;
            margin-bottom: 8px;
        }

        .dark-mode .event-info {
            color: #999;
        }

        .event-info-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .event-info i {
            color: var(--secondary);
            font-size: 12px;
            min-width: 12px;
        }

        .event-info-item span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .event-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid #eee;
            margin-top: auto;
        }

        .dark-mode .event-footer {
            border-top-color: #444;
        }

        .rating {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 12px;
            font-weight: 600;
            color: var(--primary);
        }

        .dark-mode .rating {
            color: var(--text-dark);
        }

        .rating i {
            color: #ffd700;
            font-size: 13px;
        }

        .rating .review-count {
            color: #999;
            font-weight: 400;
            font-size: 10px;
        }

        .event-price {
            font-weight: 700;
            color: var(--secondary);
            font-size: 13px;
        }

        /* Responsive Adjustments */
        @media (max-width: 576px) {
            .auth-card {
                padding: 30px 20px;
            }

            .event-title {
                font-size: 13px;
                height: 34px;
            }

            .event-info {
                font-size: 10px;
            }

            .event-price {
                font-size: 12px;
            }
        }
        
        /* Notification Item */
        .notification-item {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 18px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            display: flex;
            gap: 15px;
            border-left: 4px solid var(--secondary);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dark-mode .notification-item {
            background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
        }

        .notification-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 12px rgba(0,0,0,0.15);
        }

        .notification-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 24px;
        }

        .notification-icon.success {
            background: rgba(40, 167, 69, 0.1);
        }

        .notification-icon.info {
            background: rgba(23, 162, 184, 0.1);
        }

        .notification-icon.warning {
            background: rgba(255, 193, 7, 0.1);
        }

        .notification-icon.reminder {
            background: rgba(247, 197, 102, 0.2);
        }

        .notification-icon.event {
            background: rgba(220, 53, 69, 0.1);
        }

        .notification-content {
            flex: 1;
            color: var(--text-light);
        }

        .dark-mode .notification-content {
            color: var(--text-dark);
        }
        
        .notification-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }

        .notification-unread {
            position: relative;
        }

        .notification-unread::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: var(--secondary);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: translateY(-50%) scale(1);
            }
            50% {
                opacity: 0.5;
                transform: translateY(-50%) scale(1.2);
            }
        }

        .notification-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 8px;
            height: 8px;
            background: #ff4757;
            border-radius: 50%;
        }

        /* Filter and Action Buttons */
        .filter-buttons {
            display: flex;
            gap: 8px;
            padding: 15px 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .filter-buttons::-webkit-scrollbar {
            display: none;
        }

        .filter-btn {
            padding: 6px 16px;
            background: #f0f0f0;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode .filter-btn {
            background: #2a2a2a;
            color: var(--text-dark);
        }

        .filter-btn:hover {
            background: var(--secondary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--secondary);
            color: var(--primary);
            font-weight: 600;
        }

        .event-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--secondary);
            color: var(--primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 2;
        }

        .wishlist-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .wishlist-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .wishlist-btn i {
            color: #999;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .wishlist-btn.active i {
            color: #ff4757;
            transform: scale(1.2);
        }

        .wishlist-btn.animating i {
            animation: heartBeat 0.6s ease-in-out;
        }
        
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.3); }
            50% { transform: scale(1.1); }
            75% { transform: scale(1.2); }
        }

        /* Search Bar */
        .search-bar {
            padding: 20px;
            margin-top: 50px;
        }

        .search-input {
            border-radius: 25px;
            border: 2px solid #eee;
            padding: 12px 20px;
            padding-left: 45px;
            width: 100%;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(247, 197, 102, 0.1);
        }

        .dark-mode .search-input {
            background: #2a2a2a;
            border-color: #444;
            color: white;
        }

        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        /* Profile Page */
        .profile-header {
            background: linear-gradient(135deg, var(--primary) 0%, #2a2a2a 100%);
            padding: 40px 20px;
            text-align: center;
            color: white;
            border-radius: 0 0 30px 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 48px;
            color: var(--primary);
            position: relative;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .edit-avatar-btn {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--secondary);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--primary);
        }

        .edit-avatar-btn:hover {
            background: #e6b855;
        }

        .profile-name {
            font-weight: 600;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .profile-email {
            opacity: 0.8;
            font-size: 14px;
        }

        .profile-menu {
            padding: 20px;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode .menu-item {
            background: #2a2a2a;
        }

        .menu-item:hover {
            transform: translateX(5px);
            background: #f8f9fa;
        }
        
        .dark-mode .menu-item:hover {
            background: #333;
        }

        .menu-item-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(247, 197, 102, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--secondary);
        }

        /* Certificate Card */
        .certificate-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .certificate-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .dark-mode .certificate-card {
            background: #2a2a2a;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #ccc;
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--secondary);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 10px;
            padding: 20px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .tab-nav::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            color: var(--text-light);
        }

        .dark-mode .tab-btn {
            background: #2a2a2a;
            color: var(--text-dark);
        }

        .tab-btn.active {
            background: var(--secondary);
            color: var(--primary);
        }

        /* Modal */
        .modal-content {
            border-radius: 20px;
            border: none;
        }

        .modal-header {
            background: var(--primary);
            color: white;
            border-radius: 20px 20px 0 0;
            border: none;
        }

        /* DARK MODE - MODAL */
        body.dark-mode .modal-content {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        body.dark-mode .modal-header,
        body.dark-mode .modal-footer {
            border-color: #333;
        }

        body.dark-mode .modal-title {
            color: #ffffff;
        }

        body.dark-mode .modal-body {
            color: #dddddd;
        }

        /* Button secondary */
        body.dark-mode .btn-secondary {
            background-color: #2a2a2a;
            color: #ffffff;
            border-color: #444;
        }

        /* Close / dismiss button */
        body.dark-mode .btn-close {
            filter: invert(1);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

       /* Payment Styles */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .payment-method {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode .payment-method {
            border-color: #444;
        }

        .payment-method:hover {
            border-color: var(--secondary);
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: var(--secondary);
            background: rgba(247, 197, 102, 0.1);
        }

        .payment-method i {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .payment-method .bank-logo {
            width: 80px;
            height: 40px;
            margin: 0 auto 10px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .payment-steps {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            position: relative;
        }

        .payment-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: #eee;
            z-index: 1;
        }

        .dark-mode .payment-steps::before {
            background: #444;
        }

        .payment-step {
            text-align: center;
            position: relative;
            z-index: 2;
            flex: 1;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .dark-mode .step-number {
            background: #444;
        }

        .payment-step.active .step-number {
            background: var(--secondary);
            color: var(--primary);
        }

        .payment-step.completed .step-number {
            background: #28a745;
            color: white;
        }

        .step-title {
            font-size: 12px;
            font-weight: 600;
        }

        .payment-summary {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .dark-mode .payment-summary {
            background: #2a2a2a;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .dark-mode .summary-item {
            border-bottom-color: #444;
        }

        .summary-item.total {
            font-weight: 700;
            font-size: 18px;
            border-bottom: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #ddd;
        }

        .dark-mode .summary-item.total {
            border-top-color: #444;
        }

        /* Chat Improvements */
        .chat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: white;
            border-bottom: 1px solid #eee;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .dark-mode .chat-header {
            background: var(--bg-dark);
            border-bottom-color: #333;
        }

        .chat-back-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--secondary);
            transition: all 0.3s ease;
        }

        .chat-back-btn:hover {
            transform: translateX(-3px);
        }

        .chat-participants {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
            margin: 10px 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .dark-mode .chat-participants {
            background: #2a2a2a;
        }

        .chat-participant {
            display: flex;
            align-items: center;
            gap: 5px;
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .dark-mode .chat-participant {
            background: #333;
        }

        .participant-avatar {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--primary);
            font-weight: 600;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px 15px;
            background: #f0f0f0;
            border-radius: 15px;
            width: fit-content;
            margin: 10px 0;
        }

        .dark-mode .typing-indicator {
            background: #2a2a2a;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-5px);
            }
        }

        /* Payment QR Code */
        .qr-code-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
        }

        .dark-mode .qr-code-container {
            background: #2a2a2a;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 48px;
            color: #333;
            border: 2px dashed #ddd;
        }

        .payment-timer {
            font-size: 24px;
            font-weight: 700;
            color: #ff4757;
            margin: 15px 0;
            font-family: monospace;
        }

        .payment-instruction {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        .dark-mode .payment-instruction {
            background: #2a2a2a;
        }

        .payment-success {
            text-align: center;
            padding: 20px 0;
        }

        .payment-success i {
            font-size: 64px;
            color: #28a745;
            margin-bottom: 20px;
            animation: success 1s ease;
        }

        @keyframes success {
            0% {
                transform: scale(0);
            }
            50% {
                transform: scale(1.2);
            }
            100% {
                transform: scale(1);
            }
        }

        /* Chat Container */
        .chat-container {
            padding: 20px;
            height: calc(100vh - 200px);
            overflow-y: auto;
            padding-bottom: 80px;
        }

        .chat-messages {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .message {
            display: flex;
            gap: 10px;
            align-items: flex-start;
            max-width: 85%;
        }

        .message.own {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-weight: 600;
            flex-shrink: 0;
            font-size: 14px;
        }

        .message-content {
            background: #f0f0f0;
            padding: 12px 15px;
            border-radius: 15px;
            position: relative;
            max-width: 100%;
            word-wrap: break-word;
        }

        .dark-mode .message-content {
            background: #2a2a2a;
        }

        .message.own .message-content {
            background: var(--secondary);
            color: var(--primary);
        }

        .message-name {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #666;
        }

        .dark-mode .message-name {
            color: #999;
        }

        .message-time {
            font-size: 10px;
            color: #999;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: white;
            border-top: 1px solid #eee;
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            z-index: 10;
        }

        .dark-mode .chat-input-area {
            background: var(--bg-dark);
            border-top-color: #333;
        }

        .chat-input {
            flex: 1;
            border: 2px solid #eee;
            border-radius: 25px;
            padding: 12px 20px;
            outline: none;
            font-size: 14px;
        }

        .dark-mode .chat-input {
            background: #2a2a2a;
            border-color: #444;
            color: white;
        }

        .chat-input:focus {
            border-color: var(--secondary);
        }

        .chat-action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--secondary);
            border: none;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-action-btn:hover {
            transform: scale(1.1);
            background: #e6b855;
        }

        .chat-quick-replies {
            display: flex;
            gap: 10px;
            padding: 0 20px 10px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .chat-quick-replies::-webkit-scrollbar {
            display: none;
        }

        .quick-reply {
            background: #f0f0f0;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode .quick-reply {
            background: #2a2a2a;
            color: white;
        }

        .quick-reply:hover {
            background: var(--secondary);
            color: var(--primary);
        }

        .message-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 11px;
            opacity: 0.7;
            margin-top: 2px;
        }

        .message-status i {
            font-size: 10px;
        }

        /* Chat Message Types */
        .message.file {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
        }

        .dark-mode .message.file {
            background: rgba(33, 150, 243, 0.1);
            border-color: rgba(33, 150, 243, 0.3);
        }

        .message.event {
            background: #e8f5e9;
            border: 1px solid #c8e6c9;
        }

        .dark-mode .message.event {
            background: rgba(76, 175, 80, 0.1);
            border-color: rgba(76, 175, 80, 0.3);
        }

        .message.system {
            background: #fff3e0;
            border: 1px solid #ffe0b2;
        }

        .dark-mode .message.system {
            background: rgba(255, 152, 0, 0.1);
            border-color: rgba(255, 152, 0, 0.3);
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: var(--secondary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--primary);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 12px;
        }

        .file-size {
            font-size: 11px;
            color: #666;
        }

        .download-btn {
            background: none;
            border: none;
            color: var(--secondary);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        /* FAQ Styles */
        .faq-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode .faq-item {
            background: #2a2a2a;
        }

        .faq-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .faq-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--text-light);
        }

        .dark-mode .faq-question {
            color: var(--text-dark);
        }

        .faq-answer {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
            color: #666;
            line-height: 1.6;
        }

        .dark-mode .faq-answer {
            border-top-color: #444;
            color: #999;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-icon {
            transition: transform 0.3s ease;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

       /* Form Styles */
        .form-control {
            border-radius: 10px;
            padding: 12px 15px;
            border: 2px solid #eee;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(247, 197, 102, 0.1);
        }

        .dark-mode .form-control {
            background: #2a2a2a;
            border-color: #444;
            color: white;
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Toast Notification */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--secondary);
            color: var(--primary);
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 9999;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            max-width: 300px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.3s ease-out;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Badge Styles */
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-primary {
            background: var(--secondary);
            color: var(--primary);
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #212529;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

         /* Sembunyikan bottom nav di halaman auth */
        .page.auth-page ~ .bottom-nav {
            display: none;
        }

        .category-back-section {
            position: relative;
            padding-top: 30px; /* Memberi jarak untuk tombol back */
        }
        
        /* Tombol back kategori */
        .back-category-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(15, 15, 15, 0.9);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        
        .back-category-btn:hover {
            background: var(--secondary);
            color: var(--primary);
            transform: translateX(-5px);
        }
        
        /* QR Code Tiket Style */
        .ticket-qr-container {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .dark-mode .ticket-qr-container {
            background: #2a2a2a;
        }
        
        .ticket-qr-code {
            width: 250px;
            height: 250px;
            margin: 0 auto;
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .ticket-details {
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            text-align: left;
        }
        
        .dark-mode .ticket-details {
            background: #333;
        }
        
        .ticket-field {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .dark-mode .ticket-field {
            border-bottom-color: #444;
        }
        
        .ticket-field:last-child {
            border-bottom: none;
        }
        
        .ticket-field .label {
            font-weight: 600;
            color: #666;
        }
        
        .dark-mode .ticket-field .label {
            color: #999;
        }
        
        .ticket-field .value {
            font-weight: 600;
            color: var(--primary);
        }
        
        .dark-mode .ticket-field .value {
            color: var(--secondary);
        }

        /* PERBAIKAN: Sembunyikan header section saat filter kategori aktif */
        .filter-active .header-section {
            display: none;
        }
        
        /* Style untuk tombol lihat tiket di card event terdaftar */
        .view-ticket-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--secondary);
            color: var(--primary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .view-ticket-btn:hover {
            background: #e6b855;
            transform: scale(1.1);
        }
        
        .view-ticket-btn i {
            font-size: 18px;
        }

        /* Style untuk menu Tiket Saya di profil */
        .tickets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            padding: 15px;
        }

        .ticket-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border-left: 4px solid var(--secondary);
        }

        .dark-mode .ticket-card {
            background: linear-gradient(135deg, #2a2a2a 0%, #1f1f1f 100%);
        }

        .ticket-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .ticket-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, transparent 40%, rgba(247, 197, 102, 0.1) 100%);
            border-radius: 0 15px 0 0;
        }

        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .ticket-status {
            background: var(--secondary);
            color: var(--primary);
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .ticket-status.free {
            background: #28a745;
            color: white;
        }

        .ticket-status.paid {
            background: #007bff;
            color: white;
        }

        .ticket-code {
            font-size: 12px;
            color: #666;
            font-family: 'Courier New', monospace;
            background: #f1f1f1;
            padding: 4px 10px;
            border-radius: 10px;
            margin-top: 5px;
            display: inline-block;
        }

        .dark-mode .ticket-code {
            background: #333;
            color: #999;
        }

        .ticket-details {
            margin: 15px 0;
        }

        .ticket-detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .ticket-detail-item i {
            color: var(--secondary);
            width: 20px;
            text-align: center;
        }

        .ticket-detail-item span {
            color: var(--text-light);
            flex: 1;
        }

        .dark-mode .ticket-detail-item span {
            color: var(--text-dark);
        }

        .ticket-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .ticket-action-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .ticket-action-btn.primary {
            background: var(--secondary);
            color: var(--primary);
            border: none;
        }

        .ticket-action-btn.secondary {
            background: #f0f0f0;
            color: var(--text-light);
            border: 1px solid #ddd;
        }

        .dark-mode .ticket-action-btn.secondary {
            background: #333;
            border-color: #444;
            color: var(--text-dark);
        }

        .ticket-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .ticket-footer {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
            font-size: 12px;
            color: #999;
            display: flex;
            justify-content: space-between;
        }

        .dark-mode .ticket-footer {
            border-top-color: #444;
        }

        /* Empty State for Tickets */
        .empty-tickets {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-tickets i {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
            display: block;
        }

        .empty-tickets h5 {
            margin: 10px 0;
            color: var(--text-light);
        }

        .dark-mode .empty-tickets h5 {
            color: var(--text-dark);
        }

        .empty-tickets p {
            font-size: 14px;
            margin-bottom: 30px;
        }

        /* QR Code Display Enhancement */
        .ticket-qr-display {
            text-align: center;
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .dark-mode .ticket-qr-display {
            background: #2a2a2a;
        }

        .ticket-qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode .ticket-qr-code {
            background: white;
        }

        .ticket-qr-code canvas {
            width: 170px !important;
            height: 170px !important;
        }

        /* PERBAIKAN: Backdrop untuk mencegah klik setelah modal */
        .modal-backdrop {
            z-index: 1040 !important;
        }
        
        .modal {
            z-index: 1050 !important;
        }

        /* Fix untuk wishlist button di dalam modal */
        .modal .wishlist-btn {
            z-index: 1060 !important;
        }

        /* PERBAIKAN: QR Code generator styles */
        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #qrcode canvas {
            width: 100% !important;
            height: auto !important;
            max-width: 170px;
            max-height: 170px;
        }
        
        /* Loading untuk QR Code */
        .qr-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
        }
        
        .qr-loading .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .qr-loading p {
            margin-top: 15px;
            color: #666;
        }
        
        /* PERBAIKAN: Event card dalam modal */
        .modal .event-image-wrapper {
            position: relative;
        }
        
        .modal .wishlist-btn {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        /* PERBAIKAN: Modal backdrop fix */
        body.modal-open {
            overflow: hidden;
            padding-right: 0 !important;
        }

        .action-buttons {
    display: flex;
    gap: 16px;               
    justify-content: center; 
    margin-top: 24px;
}

.action-buttons button {
    padding: 14px;
    border-radius: 12px;
    font-size: 14px;
    border: none;
}

.btn-unduh {
    background-color: #EBC46B;
    color: #000;
    font-weight: 600;
}

.btn-selesai {
    background-color: #1E8B53;
    color: #fff;
    font-weight: 600;
}

    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="page auth-page active">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-logo">
                    <h1> Eventraze</h1>
                    <p>Temukan Event Terbaik di Indonesia</p>
                </div>
                <form id="loginForm">
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="rememberMe">
                        <label class="form-check-label" for="rememberMe">Ingat Saya</label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">Masuk</button>
                    <div class="text-center">
                        <a href="#" onclick="showPage('forgotPage')" class="text-decoration-none">Lupa Password?</a>
                    </div>
                    <hr class="my-3">
                    <div class="text-center">
                        <span>Belum punya akun? </span>
                        <a href="#" onclick="showPage('registerPage')" class="text-decoration-none fw-bold">Daftar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="registerPage" class="page auth-page">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-logo">
                    <h1> Eventraze</h1>
                    <p>Buat Akun Baru</p>
                </div>
                <form id="registerForm">
                    <div class="mb-3">
                        <label class="form-label">Nama Lengkap</label>
                        <input type="text" class="form-control" id="registerName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="registerEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="registerPassword" required minlength="6">
                        <small class="text-muted">Minimal 6 karakter</small>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">Daftar</button>
                    <div class="text-center">
                        <span>Sudah punya akun? </span>
                        <a href="#" onclick="showPage('loginPage')" class="text-decoration-none fw-bold">Masuk</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Forgot Password Page -->
    <div id="forgotPage" class="page auth-page">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-logo">
                    <h1></h1>
                    <h4>Lupa Password</h4>
                    <p>Masukkan email untuk reset password</p>
                </div>
                <form id="forgotForm">
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="forgotEmail" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 mb-3">Kirim Link Reset</button>
                    <div class="text-center">
                        <a href="#" onclick="showPage('loginPage')" class="text-decoration-none">Kembali ke Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App: Home Page -->
    <div id="homePage" class="page">
         <!-- Tombol Back untuk Kategori -->
        <div class="back-category-btn" id="backCategoryBtn" style="display: none;" onclick="backToHomeFromCategory()">
            <i class="bi bi-arrow-left"></i>
        </div>

        <!-- Header Section - akan disembunyikan saat filter aktif -->
        <div class="header-section" id="headerSection">
            <div class="greeting">
                <h2 id="greetingText">Halo, User!</h2>
                <p>Temukan event menarik di sekitar Indonesia</p>
            </div>
        </div>

        <div class="megaphone-container" id="megaphoneContainer">
            <span class="megaphone"></span>
        </div>

        <div class="search-bar">
            <div class="search-container">
                <i class="bi bi-search search-icon"></i>
                <input type="text" class="search-input" placeholder="Cari event..." id="searchInput">
            </div>
        </div>

        <h5 id="categoryTitle" style="padding: 0 20px; margin-bottom: 10px; font-weight: 600; font-size: 16px;">Kategori</h5>
        <div class="categories-slider" id="categoriesSlider">
            <div class="category-card" onclick="filterByCategory('pendidikan')">
                <i class="bi bi-mortarboard"></i>
                <h6>Pendidikan</h6>
            </div>
            <div class="category-card" onclick="filterByCategory('musik')">
                <i class="bi bi-music-note-beamed"></i>
                <h6>Musik</h6>
            </div>
            <div class="category-card" onclick="filterByCategory('olahraga')">
                <i class="bi bi-trophy"></i>
                <h6>Olahraga</h6>
            </div>
            <div class="category-card" onclick="filterByCategory('')">
                <i class="bi bi-grid"></i>
                <h6>Semua</h6>
            </div>
        </div>

        <h5 id="videoTitle" class="px-3 mb-3 mt-4">Event Highlights Video</h5>
        <div class="video-slider-container" id="videoSliderContainer">
            <div class="video-slider">
                <div class="video-card-youtube">
                    <iframe 
                        src="https://www.youtube.com/embed/PGNJNYuL41A"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                    <div class="video-overlay">
                        <h6 class="mb-0">Mediaclash Basket Ball</h6>
                        <small>Event Olahraga</small>
                    </div>
                </div>
                <div class="video-card-youtube">
                    <iframe src="https://www.youtube.com/embed/AhLOne3sABU" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="video-overlay">
                        <h6 class="mb-0">Batfest 2022 After Movie</h6>
                        <small>Event Musik</small>
                    </div>
                </div>
                <div class="video-card-youtube">
                    <iframe src="https://www.youtube.com/embed/HUR_dKkr9_o" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="video-overlay">
                        <h6 class="mb-0">Webinar Pembelajaran Mendalam</h6>
                        <small>Event Pendidikan</small>
                    </div>
                </div>
                <div class="video-card-youtube">
                    <iframe src="https://www.youtube.com/embed/abiCrLOamMk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="video-overlay">
                        <h6 class="mb-0">After Movie Pestapora 2024</h6>
                        <small>Event Musik</small>
                    </div>
                </div>
                <div class="video-card-youtube">
                    <iframe src="https://www.youtube.com/embed/INlCe2EpBRk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    <div class="video-overlay">
                        <h6 class="mb-0">Webinar Penguatan Pendidikan Karakter</h6>
                        <small>Event Pendidikan</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="section-header">
            <h5>Event Rekomendasi</h5>
        </div>
        <div id="eventsList" class="events-grid"></div>
    </div>

    <!-- Main App: Reminder Page -->
    <div id="reminderPage" class="page">
        <div class="header-section">
            <h2>Pengingat</h2>
            <p>Event yang disimpan dan terdaftar</p>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchReminderTab('notifikasi')">Notifikasi</button>
            <button class="tab-btn" onclick="switchReminderTab('wishlist')">Wishlist</button>
            <button class="tab-btn" onclick="switchReminderTab('registered')">Terdaftar</button>
            <button class="tab-btn" onclick="switchReminderTab('history')">Riwayat</button>
        </div>

        <div id="notifikasiTab" class="tab-content">
            <div id="notificationsList" class="px-3"></div>
        </div>

        <div id="wishlistTab" class="tab-content" style="display:none;">
            <div id="wishlistList" class="px-3"></div>
        </div>

        <div id="registeredTab" class="tab-content" style="display:none;">
            <div id="registeredList" class="px-3"></div>
        </div>

        <div id="historyTab" class="tab-content" style="display:none;">
            <div id="historyList" class="px-3"></div>
        </div>
    </div>

     <!-- Chat Page -->
    <div id="chatPage" class="page">
        <div class="chat-header">
            <button class="chat-back-btn" onclick="backToHomeFromChat()">
                <i class="bi bi-arrow-left"></i>
            </button>
            <div>
                <h6 id="chatEventTitle" class="mb-0">Chat Event</h6>
                <small class="text-muted" id="chatParticipantsCount">3 peserta online</small>
            </div>
        </div>

        <div class="chat-participants px-3">
            <span class="text-muted" style="font-size: 12px;">Peserta:</span>
            <div class="chat-participant">
                <div class="participant-avatar">O</div>
                <span>Organizer</span>
            </div>
            <div class="chat-participant">
                <div class="participant-avatar" id="userAvatarChat">U</div>
                <span id="userNameChat">Anda</span>
            </div>
            <div class="chat-participant">
                <div class="participant-avatar">+5</div>
                <span>Lainnya</span>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages"></div>
            
            <div class="chat-quick-replies" id="quickReplies">
                <button class="quick-reply" onclick="sendQuickReply('Kapan event dimulai?')">Kapan event dimulai?</button>
                <button class="quick-reply" onclick="sendQuickReply('Dimana lokasi tepatnya?')">Dimana lokasi tepatnya?</button>
                <button class="quick-reply" onclick="sendQuickReply('Apakah ada dress code?')">Apakah ada dress code?</button>
                <button class="quick-reply" onclick="sendQuickReply('Boleh bawa keluarga?')">Boleh bawa keluarga?</button>
            </div>
        </div>

        <div class="chat-input-area">
            <button class="chat-action-btn" onclick="attachFile()">
                <i class="bi bi-paperclip"></i>
            </button>
            <input type="text" class="chat-input" id="chatInput" placeholder="Ketik pesan..." onkeypress="if(event.key === 'Enter') sendMessage()">
            <button class="chat-action-btn" onclick="sendMessage()">
                <i class="bi bi-send-fill"></i>
            </button>
        </div>
    </div>


    <!-- Main App: Profile Page -->
    <div id="profilePage" class="page">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <span id="avatarInitial">U</span>
                <input type="file" id="avatarInput" accept="image/*" style="display:none;">
            </div>
            <div class="profile-name" id="profileName">User</div>
            <div class="profile-email" id="profileEmail">user@email.com</div>
        </div>

        <div class="profile-menu">
            <div class="menu-item" onclick="showEditProfile()">
                <div class="menu-item-left">
                    <div class="menu-icon"><i class="bi bi-person"></i></div>
                    <div>
                        <div class="fw-semibold">Edit Profil</div>
                        <small class="text-muted">Ubah data pribadi</small>
                    </div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </div>

             <div class="menu-item" onclick="showMyTickets()">
                <div class="menu-item-left">
                    <div class="menu-icon"><i class="bi bi-ticket-perforated"></i></div>
                    <div>
                        <div class="fw-semibold">Tiket Saya</div>
                        <small class="text-muted">Lihat dan kelola tiket</small>
                    </div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </div>

            <div class="menu-item" onclick="showCertificates()">
                <div class="menu-item-left">
                    <div class="menu-icon"><i class="bi bi-award"></i></div>
                    <div>
                        <div class="fw-semibold">Sertifikat</div>
                        <small class="text-muted">Lihat semua sertifikat</small>
                    </div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </div>

            <div class="menu-item">
                <div class="menu-item-left">
                    <div class="menu-icon"><i class="bi bi-bell"></i></div>
                    <div>
                        <div class="fw-semibold">Notifikasi</div>
                        <small class="text-muted">Atur pengingat event</small>
                    </div>
                </div>
                <div class="toggle-switch" id="notifToggle" onclick="toggleNotifications()">
                    <div class="toggle-slider"></div>
                </div>
            </div>

            <div class="menu-item">
                <div class="menu-item-left">
                    <div class="menu-icon"><i class="bi bi-moon"></i></div>
                    <div>
                        <div class="fw-semibold">Dark Mode</div>
                        <small class="text-muted">Tema gelap</small>
                    </div>
                </div>
                <div class="toggle-switch" id="darkModeToggle" onclick="toggleDarkMode()">
                    <div class="toggle-slider"></div>
                </div>
            </div>

            <div class="menu-item" onclick="showHelp()">
                <div class="menu-item-left">
                    <div class="menu-icon"><i class="bi bi-question-circle"></i></div>
                    <div>
                        <div class="fw-semibold">Bantuan & FAQ</div>
                        <small class="text-muted">FAQ dan support</small>
                    </div>
                </div>
                <i class="bi bi-chevron-right"></i>
            </div>

            <div class="menu-item" onclick="logout()">
                <div class="menu-item-left">
                    <div class="menu-icon text-danger"><i class="bi bi-box-arrow-right"></i></div>
                    <div>
                        <div class="fw-semibold text-danger">Keluar</div>
                        <small class="text-muted">Logout dari akun</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <a class="nav-item active" onclick="showMainPage('homePage')">
        <i class="bi bi-house-fill"></i>
        <span>Beranda</span>
    </a>
    <a class="nav-item" onclick="showMainPage('reminderPage')">
        <i class="bi bi-bell-fill"></i>
        <span>Pengingat</span>
    </a>
    <a class="nav-item" onclick="showMainPage('profilePage')">
        <i class="bi bi-person-fill"></i>
        <span>Profil</span>
    </a>
</div>

<!-- Modals -->
    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pembayaran Tiket</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="paymentContent"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Event Detail Modal -->
    <div class="modal fade" id="eventDetailModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalEventTitle"></h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="modalEventBody"></div>
                <div class="modal-footer" id="modalEventFooter"></div>
            </div>
        </div>
    </div>
    
    <!-- Edit Profile Modal -->
    <div class="modal fade" id="editProfileModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Profil</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editProfileForm">
                        <div class="mb-3 text-center">
                            <div class="profile-avatar mx-auto" style="width: 80px; height: 80px;" id="editAvatarPreview">
                                <span id="editAvatarInitial">U</span>
                            </div>
                            <button type="button" class="btn btn-sm btn-primary mt-2" onclick="document.getElementById('avatarInput').click()">
                                Ubah Foto
                            </button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="editEmail" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Simpan Perubahan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL BARU: Tiket Saya -->
    <div class="modal fade" id="myTicketsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"> Tiket Saya</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="myTicketsList">
                        <!-- Tiket akan ditampilkan di sini -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Certificates Modal -->
    <div class="modal fade" id="certificatesModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sertifikat Saya</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="certificatesList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help/FAQ Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"> Bantuan & FAQ</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <h6 class="mb-3"> Hubungi Kami</h6>
                        <div class="p-3 rounded">
                            <p class="mb-2"><i class="bi bi-envelope me-2"></i> Email: support@eventraze.com</p>
                            <p class="mb-2"><i class="bi bi-telephone me-2"></i> Telepon: 0812-3456-7890</p>
                            <p class="mb-0"><i class="bi bi-whatsapp me-2"></i> WhatsApp: 0812-3456-7890</p>
                        </div>
                    </div>

                    <h6 class="mb-3"> Pertanyaan yang Sering Diajukan</h6>
                    
                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Bagaimana cara mendaftar event?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            1. Pilih event yang ingin Anda ikuti dari halaman beranda<br>
                            2. Klik event tersebut untuk melihat detail<br>
                            3. Klik tombol "Beli Tiket" atau "Daftar Event"<br>
                            4. Konfirmasi pendaftaran Anda<br>
                            5. Event akan masuk ke tab "Terdaftar" di menu Pengingat
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Bagaimana cara membatalkan pendaftaran event?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            1. Buka menu "Pengingat" di navigasi bawah<br>
                            2. Pilih tab "Terdaftar"<br>
                            3. Klik event yang ingin dibatalkan<br>
                            4. Klik tombol "Batalkan Pendaftaran"<br>
                            5. Konfirmasi pembatalan<br>
                            <strong>Catatan:</strong> Pembatalan mungkin dikenakan syarat dan ketentuan tertentu tergantung kebijakan penyelenggara.
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Apa itu Wishlist dan bagaimana cara menggunakannya?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            Wishlist adalah fitur untuk menyimpan event yang Anda minati tanpa harus mendaftar.<br><br>
                            Cara menggunakan:<br>
                            1. Klik ikon hati () pada card event<br>
                            2. Event akan tersimpan di tab "Wishlist" menu Pengingat<br>
                            3. Anda akan mendapat notifikasi jika ada perubahan pada event tersebut<br>
                            4. Klik lagi ikon hati untuk menghapus dari wishlist
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Bagaimana cara mendapatkan sertifikat?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            Sertifikat akan otomatis tersedia setelah Anda menyelesaikan event:<br><br>
                            1. Ikuti event hingga selesai<br>
                            2. Event akan berpindah ke tab "Riwayat"<br>
                            3. Klik tombol "Lihat Sertifikat"<br>
                            4. Anda bisa mengunduh atau membagikan sertifikat<br><br>
                            <strong>Catatan:</strong> Tidak semua event menyediakan sertifikat.
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Apakah saya bisa mencari event tertentu?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            Ya! Gunakan fitur pencarian di halaman beranda:<br><br>
                            1. Klik kotak pencarian di bagian atas halaman<br>
                            2. Ketik nama event atau kata kunci<br>
                            3. Hasil pencarian akan muncul secara otomatis<br>
                            4. Anda juga bisa filter berdasarkan kategori (Pendidikan, Musik, Olahraga)
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Bagaimana cara mengatur notifikasi?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            1. Buka menu "Profil" di navigasi bawah<br>
                            2. Cari menu "Notifikasi"<br>
                            3. Toggle on/off untuk mengaktifkan atau menonaktifkan<br>
                            4. Anda akan menerima notifikasi tentang:<br>
                            &nbsp;&nbsp;&nbsp; Event yang akan dimulai<br>
                            &nbsp;&nbsp;&nbsp; Perubahan pada event di wishlist<br>
                            &nbsp;&nbsp;&nbsp; Rekomendasi event baru<br>
                            &nbsp;&nbsp;&nbsp; Pengingat pendaftaran
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Apakah ada batasan kuota pendaftaran?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            Ya, setiap event memiliki kuota peserta yang berbeda:<br><br>
                             Kuota ditampilkan di detail event<br>
                             Progress bar menunjukkan sisa kuota<br>
                             Warna berubah sesuai ketersediaan:<br>
                            &nbsp;&nbsp;&nbsp;- Hijau: Masih banyak tersedia<br>
                            &nbsp;&nbsp;&nbsp;- Oranye: Kuota terbatas<br>
                            &nbsp;&nbsp;&nbsp;- Merah: Hampir penuh<br>
                             Jika kuota penuh, tombol daftar akan dinonaktifkan
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Bagaimana cara mengubah profil saya?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            1. Buka menu "Profil"<br>
                            2. Klik "Edit Profil"<br>
                            3. Ubah nama, email, atau foto profil<br>
                            4. Klik "Simpan Perubahan"<br><br>
                            Foto profil harus berformat JPG, PNG dengan ukuran maksimal 5MB.
                        </div>
                    </div>

                    <div class="faq-item" onclick="toggleFAQ(this)">
                        <div class="faq-question">
                            <span>Apakah Eventraze gratis?</span>
                            <i class="bi bi-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            Platform Eventraze gratis untuk digunakan!<br><br>
                             Tidak ada biaya untuk mendaftar akun<br>
                             Tidak ada biaya berlangganan<br>
                             Harga tiket event tergantung penyelenggara<br>
                             Ada banyak event gratis yang bisa Anda ikuti<br>
                             Filter event berdasarkan harga untuk menemukan event gratis
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" onclick="window.open('mailto:support@eventraze.com')">
                        <i class="bi bi-envelope"></i> Hubungi Support
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tiket QR Code Modal - BARU -->
<div class="modal fade" id="ticketModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"> QR Code Tiket</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="ticketContent">
                <!-- QR Code akan dimuat di sini -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-primary" onclick="downloadTicket()">
                    <i class="bi bi-download"></i> Simpan Tiket
                </button>
                <button type="button" class="btn btn-success" onclick="shareTicket()">
                    <i class="bi bi-share"></i> Bagikan
                </button>
            </div>
        </div>
    </div>
</div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        
        // Sample Events Data
        const eventsData = [
            // Pendidikan
            {
                id: 1,
                title: "The Creator Play Ground",
                category: "pendidikan",
                date: "28 Nov 2025, 18:00-21:00",
                location: "Online via Zoom",
                quota: 50,
                registered: 35,
                rating: 4.8,
                reviews: 120,
                image: "pendidikan/pendidikan1.png",
                description: "Pelajari strategi digital marketing terkini dari para ahli. Cocok untuk pemula hingga profesional yang ingin meningkatkan skill marketing online.",
                organizer: "Digital Marketing Indonesia",
                price: "Gratis"
            },
            {
                id: 2,
                title: "Seminar Nasional",
                category: "pendidikan",
                date: "29 Nov 2025, 08:00-Selesai",
                location: "Gedung Prof.Soedarto S.H., Universitas Diponegoro",
                quota: 150,
                registered: 120,
                rating: 4.9,
                reviews: 250,
                image: "pendidikan/pendidikan10.png",
                description: "Seminar inspiratif tentang Catalyzing A Just Energy Transition: Cross-Sector Pathway To Indonesia's Net-Zero 2060.",
                organizer: "Universitas Diponegoro",
                price: "Gratis"
            },
            {
                id: 3,
                title: "Intiwi Goes To Campus X HMTM UNJ",
                category: "pendidikan",
                date: "28 Nov 2025, 10:00-Selesai",
                location: "Online via Zoom",
                quota: 100,
                registered: 75,
                rating: 4.7,
                reviews: 85,
                image: "pendidikan/pendidikan6.png",
                description: "Webinar tentang Exploring Kobelco Welding Wire: Quality, Technology & Manufacturing Insight By PT.Intan Pertiwi Industri.",
                organizer: "Intan Pertiwi Industri X TMTM UNJ",
                price: "Rp 150.000"
            },
            {
                id: 4,
                title: "Mutivational Talk and Mentoring Session",
                category: "pendidikan",
                date: "30 Nov 2025, 08:00-10:00",
                location: "Online via Zoom",
                quota: 70,
                registered: 50,
                rating: 4.9,
                reviews: 165,
                image: "pendidikan/pendidikan4.png",
                description: "Bincang-bincang bersama para mentor dan narasumber yang hebat-hebat.",
                organizer: "Intelektual Muda Salman",
                price: "Rp 200.000"
            },
            {
                id: 5,
                title: "Kenal Profesi Hukum",
                category: "pendidikan",
                date: "28 Nov 2025, 13:00",
                location: "Ballroom UNS Tower",
                quota: 60,
                registered: 45,
                rating: 4.8,
                reviews: 95,
                image: "pendidikan/pendidikan7.png",
                description: "Belajar dan mengenal profesi hukum. Dapatkan banyak benefit dari mengikuti seminar ini!",
                organizer: "Universitas Sebelas Maret",
                price: "Gratis"
            },
            {
                id: 6,
                title: "E-Seminar Nasional Inkubasi Bisnis & Investasi",
                category: "pendidikan",
                date: "27 Nov 2025, 13:30-15:30",
                location: "Online via Zoom",
                quota: 100,
                registered: 80,
                rating: 4.9,
                reviews: 140,
                image: "pendidikan/pendidikan9.png",
                description: "E-Seminar Nasional bersama 3 narasumber dengan keynote speaker bernama Ir. A Sigit Pramono Hadi M.Si.",
                organizer: "STIE Kasih Bangsa",
                price: "Gratis"
            },

            // Musik
            {
                id: 7,
                title: "Gen Z Fest",
                category: "musik",
                date: "29-30 Nov 2024",
                location: "Plaza Parkir Timur GBK, Jakarta",
                quota: 500,
                registered: 450,
                rating: 4.9,
                reviews: 320,
                image: "music/dontplay.jpg",
                description: "Malam yang penuh dengan alunan musisi lokal dan nasional terbaik di Plaza Timur GBK, Jakarta.",
                organizer: "Don't Play Play",
                price: "Rp 65.000"
            },
            {
                id: 8,
                title: "Jogja Rock Arta",
                category: "musik",
                date: "6-7 Des 2025",
                location: "Kridosono Stadium Yogyakarta Indonesia",
                quota: 300,
                registered: 200,
                rating: 4.7,
                reviews: 180,
                image: "music/jogjarock.jpg",
                description: "Konser rock dengan penampilan dari penyanyi-penyanyi rock favorit.",
                organizer: "Supermusic",
                price: "Rp 100.000"
            },
            {
                id: 9,
                title: "Jomlo Festival",
                category: "musik",
                date: "7 Des 2025",
                location: "Lapangan Parkir Stadion Mandala Krida",
                quota: 700,
                registered: 650,
                rating: 4.8,
                reviews: 450,
                image: "music/jomlo.jpg",
                description: "Festival musik terbesar dengan penyanyi dangdut ternama.",
                organizer: "Kontener Production",
                price: "Rp 90.000 - Rp 120.000"
            },
            {
                id: 10,
                title: "Rayu Doa Raya",
                category: "musik",
                date: "7 Des 2025",
                location: "Taman rekreasi Alam mayang",
                quota: 300,
                registered: 180,
                rating: 4.6,
                reviews: 75,
                image: "music/rayudoa.jpg",
                description: "Konser bersama Sal dan Nadia Amizah",
                organizer: "Ourcreative",
                price: "Rp 50.000"
            },
            {
                id: 11,
                title: "Rockland Festival",
                category: "musik",
                date: "14 des 2025",
                location: "Vivo mall sentul Bogor",
                quota: 250,
                registered: 200,
                rating: 4.9,
                reviews: 110,
                image: "music/rockland.jpg",
                description: "Konser musik-musik modern. Nikmati irama musiknya bersama orang tersayang.",
                organizer: "Rockland",
                price: "Rp 100.000"
            },
            {
                id: 12,
                title: "DJ Electronic Party",
                category: "musik",
                date: "14 Des 2025, 21:00",
                location: "Lapangan Parkir Stadion Mandala Krida",
                quota: 400,
                registered: 350,
                rating: 4.7,
                reviews: 290,
                image: "music/saemen.jpg",
                description: "Pesta bersama. Get ready untuk malam yang tak terlupakan!",
                organizer: "Saemenfest",
                price: "Rp 175.000 - Rp 225.000"
            },

            // Olahraga
            {
                id: 13,
                title: "Kejuaraan Olahraga",
                category: "olahraga",
                date: "11-12 Jan 2025, 09:00",
                location: "SMAN Howgumi Boarding School",
                quota: 25,
                registered: 20,
                rating: 4.9,
                reviews: 380,
                image: "olahraga/olahraga1.png",
                description: "Tiga cabang olahraga yaitu basket, sepak bola, dan voli.",
                organizer: "SMAN Howgumi Boarding School",
                price: "Gratis"
            },
            {
                id: 14,
                title: "Fun Bike",
                category: "olahraga",
                date: "20 Okt 2021, 07:00",
                location: "lapangan Utara kampung Gelgel",
                quota: 75,
                registered: 60,
                rating: 4.7,
                reviews: 145,
                image: "olahraga/olahraga3.png",
                description: "Pekan olahraga, seni, dan religi.",
                organizer: "Pra-maulid Multiple Games",
                price: "Rp 10.000"
            },
            {
                id: 15,
                title: "Dies Natalies Badminton Kompetition",
                category: "olahraga",
                date: "15-18 Juli 2025",
                location: "Gedung Olahraga AKN Manado",
                quota: 50,
                registered: 35,
                rating: 4.8,
                reviews: 125,
                image: "olahraga/olahraga4.png",
                description: "Kategori lomba ganda campuran.Total hadiah Rp 1.000.000,-.",
                organizer: "AKN Manado",
                price: "Rp 35.000"
            },
            {
                id: 16,
                title: "Trans Competition",
                category: "olahraga",
                date: "14 Sep 2025",
                location: "Trans Studio Bandung",
                quota: 150,
                registered: 100,
                rating: 4.7,
                reviews: 98,
                image: "olahraga/olahraga5.png",
                description: "Terdapat 2 lomba yaitu lomba basket dan lomba tenis meja. Dapatkan hadiah menarik!",
                organizer: "Trans Studio Bandung",
                price: "Rp 75.000"
            },
            {
                id: 17,
                title: "Fun Bike Adventure",
                category: "olahraga",
                date: "04 Feb 2024, 06:00",
                location: "Mondae Coffee",
                quota: 70,
                registered: 55,
                rating: 4.8,
                reviews: 210,
                image: "olahraga/olahraga6.png",
                description: "5k Fun Run. Fun Games. Doorprize. Photobox. Ayo segera daftarkan dirimu bersama teman atau keluargamu!",
                organizer: "Sini Sana Running Club",
                price: "Rp 35.000"
            },
            {
                id: 18,
                title: "Karate Championship",
                category: "olahraga",
                date: "9-11 April 2021",
                location: "Gedung Grha UKM UNS Lt.2",
                quota: 20,
                registered: 15,
                rating: 4.6,
                reviews: 87,
                image: "olahraga/olahraga9.png",
                description: "Karate Championship UNS dengan Hadiah menarik untuk juara. Strong, Brave, and Healthy.",
                organizer: "UKM INKAI UNS",
                price: "Rp 300.000/tim"
            },

            // Workshop
            {
                id: 19,
                title: "Canva For Career",
                category: "pendidikan",
                date: "10 Des 2025, 13:00-selesai",
                location: "Online via Zoom",
                quota: 25,
                registered: 20,
                rating: 4.9,
                reviews: 156,
                image: "Pendidikan+Musik/pendidikan13.jpeg",
                description: "Kelas design canva. Dapatkan skill design kmu mulai dari sini!",
                organizer: "Feducation",
                price: "Gratis"
            },
            {
                id: 20,
                title: "Pelatihan Food Safety",
                category: "pendidikan",
                date: "29-30 Nov 2025, 08:00-12:00",
                location: "Online via Zoom",
                quota: 20,
                registered: 18,
                rating: 4.8,
                reviews: 132,
                image: "pendidikan/pendidikan3.png",
                description: "Pelatihan keamanan pangan (GMP, HACCP, ISO22000, dan FSSC22000).",
                organizer: "Makin Ahli",
                price: "Gratis"
            },
            {
                id: 21,
                title: "Wbinar Kesehatan Matra",
                category: "pendidikan",
                date: "6 Des 2025, 08:00-13:00",
                location: "Online via Zoom",
                quota: 30,
                registered: 25,
                rating: 4.7,
                reviews: 94,
                image: "pendidikan/pendidikan8.png",
                description: "Webinar bersama tenaga kesehatan dalam penanggulangan bencana",
                organizer: "STIKES RSPAD Gatot Soebroto",
                price: "Rp 35.000"
            },
            {
                id: 22,
                title: "PBI UII Webinar",
                category: "pendidikan",
                date: "6 Des 2025, 09:00-11:30",
                location: "Online via Zoom",
                quota: 40,
                registered: 30,
                rating: 4.9,
                reviews: 178,
                image: "Pendidikan+Musik/pendidikan12.jpeg",
                description: "Belajar bersama mengenai digital dan sosial untuk modal gen z berkakrir global.",
                organizer: "Pendididkan Bahasa Inggris",
                price: "Gratis"
            },
        ];

        // Initialize App
        let currentUser = null;
        let wishlist = [];
        let registeredEvents = [];
        let eventHistory = [];
        let chatMessages = [];
        let currentEventDetail = null;
        let currentChatEvent = null;
        let notificationsEnabled = true;
        let notificationHistory = [];
        let currentFilter = '';
        let selectedPaymentMethod = '';
        let paymentTimer = 300;
        let paymentTimerInterval = null;
        let chatInitialized = false;
        let currentTicketData = null;
        let isCategoryFilterActive = false;
        let activeModal = null;

        // Check if user is logged in
        function checkAuth() {
            const session = localStorage.getItem('session');
            if (session) {
                currentUser = JSON.parse(session);
                loadUserData();
                showMainPage('homePage');
            } else {
                showPage('loginPage');
            }
            
            // Sembunyikan bottom nav di halaman auth
            updateBottomNavVisibility();
        }

         function updateBottomNavVisibility() {
            const bottomNav = document.querySelector('.bottom-nav');
            const currentPage = document.querySelector('.page.active');
            
            if (currentPage && currentPage.classList.contains('auth-page')) {
                bottomNav.style.display = 'none';
            } else {
                bottomNav.style.display = 'flex';
            }
        }

        // Show Page
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            updateBottomNavVisibility();
        }

        // Show Main Page with Navigation
       function showMainPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(nav => {
                nav.classList.remove('active');
            });

           const navItems = document.querySelectorAll('.nav-item');
            if (pageId === 'homePage' && navItems[0]) {
                navItems[0].classList.add('active');
                // Reset filter saat kembali ke home
                resetCategoryFilter();
            } else if (pageId === 'reminderPage' && navItems[1]) {
                navItems[1].classList.add('active');
                renderReminder();
            } else if (pageId === 'profilePage' && navItems[2]) {
                navItems[2].classList.add('active');
                updateProfileDisplay();
            }

            updateBottomNavVisibility();

            // Animate navigation
            anime({
                targets: '.nav-item.active i',
                scale: [1, 1.2, 1],
                translateY: [0, -5, 0],
                duration: 600,
                easing: 'easeInOutQuad'
            });
        }

        // Register Form
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;

            // Simple validation
            if (!email.includes('@')) {
                alert('Email tidak valid!');
                return;
            }

            if (password.length < 6) {
                alert('Password minimal 6 karakter!');
                return;
            }

            // Get existing users
            let users = JSON.parse(localStorage.getItem('users') || '[]');

            // Check if email already exists
            if (users.find(u => u.email === email)) {
                alert('Email sudah terdaftar!');
                return;
            }

            // Simple password hashing (base64)
            const hashedPassword = btoa(password);

            // Add new user
            const newUser = {
                id: Date.now(),
                name: name,
                email: email,
                password: hashedPassword,
                avatar: null,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));

            alert('Registrasi berhasil! Silakan login.');
            showPage('loginPage');
        });

        // Login Form
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const hashedPassword = btoa(password);
            const user = users.find(u => u.email === email && u.password === hashedPassword);

            if (user) {
                currentUser = user;
                const session = {
                    id: user.id,
                    name: user.name,
                    email: user.email,
                    avatar: user.avatar,
                    rememberMe: rememberMe
                };

                localStorage.setItem('session', JSON.stringify(session));
                loadUserData();
                showMainPage('homePage');
            } else {
                alert('Email atau password salah!');
            }
        });

        // Forgot Password
        document.getElementById('forgotForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.email === email);

            if (user) {
                alert('Link reset password telah dikirim ke email Anda!\n(Demo: Fitur ini simulasi)');
                showPage('loginPage');
            } else {
                alert('Email tidak ditemukan!');
            }
        });

        // Load User Data
        function loadUserData() {
            wishlist = JSON.parse(localStorage.getItem(`wishlist_${currentUser.id}`) || '[]');
            registeredEvents = JSON.parse(localStorage.getItem(`registered_${currentUser.id}`) || '[]');
            eventHistory = JSON.parse(localStorage.getItem(`history_${currentUser.id}`) || '[]');
            chatMessages = JSON.parse(localStorage.getItem(`chat_${currentUser.id}`) || '[]');
            notificationHistory = JSON.parse(localStorage.getItem(`notifications_${currentUser.id}`) || '[]');
            
            const settings = JSON.parse(localStorage.getItem(`settings_${currentUser.id}`) || '{}');
            notificationsEnabled = settings.notifications !== false;
            
            if (settings.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeToggle').classList.add('active');
            }

            if (notificationsEnabled) {
                document.getElementById('notifToggle').classList.add('active');
            }

            document.getElementById('greetingText').textContent = `Halo, ${currentUser.name}!`;
            renderEvents();

            // Initialize chat messages with existing data
            if (chatMessages.length === 0) {
                chatMessages = JSON.parse(localStorage.getItem(`chat_${currentUser.id}`) || '[]');
            }    
            
            // Initialize notifications
            initNotifications();
            sendWelcomeNotification();
            addDemoHistory();
        }

        // Render Events - E-commerce Style
        function renderEvents(filter = '') {
            const eventsList = document.getElementById('eventsList');
            if (!eventsList) return;

            let filteredEvents = eventsData;
            if (filter) {
                filteredEvents = eventsData.filter(e => 
                    e.category === filter || 
                    e.title.toLowerCase().includes(filter.toLowerCase())
                );
            }

            eventsList.innerHTML = filteredEvents.map(event => {
                const isInWishlist = wishlist.includes(event.id);
                return `
                    <div class="event-card" onclick="showEventDetailModal(${event.id})">
                        <div class="event-image-wrapper">
                            <img src="${event.image}" alt="${event.title}" class="event-image" loading="lazy">
                            <span class="event-badge">${event.category}</span>
                            <button class="wishlist-btn ${isInWishlist ? 'active' : ''}" 
                                    onclick="event.stopPropagation(); toggleWishlist(${event.id}, this)">
                                <i class="bi ${isInWishlist ? 'bi-heart-fill' : 'bi-heart'}"></i>
                            </button>
                        </div>
                        <div class="event-content">
                            <h6 class="event-title">${event.title}</h6>
                            <div class="event-info">
                                <div class="event-info-item">
                                    <i class="bi bi-calendar"></i>
                                    <span>${event.date.split(',')[0]}</span>
                                </div>
                                <div class="event-info-item">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>${event.location.substring(0, 20)}${event.location.length > 20 ? '...' : ''}</span>
                                </div>
                            </div>
                            <div class="event-footer">
                                <div class="rating">
                                    <i class="bi bi-star-fill"></i>
                                    <span>${event.rating}</span>
                                </div>
                                <div class="event-price">${event.price}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Animate cards with stagger
            anime({
                targets: '.event-card',
                opacity: [0, 1],
                translateY: [20, 0],
                delay: anime.stagger(50),
                duration: 400,
                easing: 'easeOutQuad'
            });
        }

        // Filter by Category - IMPROVED VERSION
        function filterByCategory(category) {
            currentFilter = category;
            
            if (category) {
                // Sembunyikan megaphone, kategori, dan video saat filter aktif
                document.getElementById('megaphoneContainer').style.display = 'none';
                document.getElementById('categoryTitle').style.display = 'none';
                document.getElementById('categoriesSlider').style.display = 'none';
                document.getElementById('videoTitle').style.display = 'none';
                document.getElementById('videoSliderContainer').style.display = 'none';
                
                // PERBAIKAN 2: Sembunyikan header section
                document.getElementById('headerSection').style.display = 'none';
                
                // Tambah class filter-active untuk styling
                document.getElementById('homePage').classList.add('filter-active');
                
                // Tampilkan tombol back
                document.getElementById('backCategoryBtn').style.display = 'flex';
                
                // Update judul
                const categoryNames = {
                    'pendidikan': 'Pendidikan',
                    'musik': 'Musik',
                    'olahraga': 'Olahraga'
                };
                
                const categoryName = categoryNames[category] || 'Semua Kategori';
                document.querySelector('.section-header h5').textContent = `Event ${categoryName}`;
            } else {
                resetCategoryFilter();
            }
            
            renderEvents(category);
            
            // Animate category selection
            anime({
                targets: '.category-card',
                scale: [1, 0.95, 1],
                duration: 300
            });
        }

        function resetCategoryFilter() {
            currentFilter = '';
            isCategoryFilterActive = false;
            
            // Tampilkan kembali semua elemen
            document.getElementById('megaphoneContainer').style.display = 'block';
            document.getElementById('categoryTitle').style.display = 'block';
            document.getElementById('categoriesSlider').style.display = 'flex';
            document.getElementById('videoTitle').style.display = 'block';
            document.getElementById('videoSliderContainer').style.display = 'block';
            
            // PERBAIKAN 2: Tampilkan kembali header section
            document.getElementById('headerSection').style.display = 'block';
            
            // Hapus class filter-active
            document.getElementById('homePage').classList.remove('filter-active');
            
            // Sembunyikan tombol back
            document.getElementById('backCategoryBtn').style.display = 'none';
            
            // Reset judul
            document.querySelector('.section-header h5').textContent = 'Event Rekomendasi';
            
            renderEvents();
        }

        function backToHomeFromCategory() {
            resetCategoryFilter();
            
            // Animate back button
            anime({
                targets: '#backCategoryBtn',
                translateX: [0, -10, 0],
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        // PERBAIKAN 2: Back dari chat ke home
        function backToHomeFromChat() {
            showMainPage('homePage');
        }

        // Search Events
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            renderEvents(query);
        });

        // Toggle Wishlist - PERBAIKAN BESAR: Menambahkan parameter buttonElement
        function toggleWishlist(eventId, buttonElement = null) {
            if (!currentUser) {
                alert('Silakan login terlebih dahulu!');
                showPage('loginPage');
                return;
            }

            const isInWishlist = wishlist.includes(eventId);
            const eventData = eventsData.find(e => e.id === eventId);
            
            // Hentikan event bubbling
            if (buttonElement) {
                buttonElement.classList.add('animating');
            }
            
            if (isInWishlist) {
                // Hapus dari wishlist
                const index = wishlist.indexOf(eventId);
                wishlist.splice(index, 1);
                
                // Update button
                if (buttonElement) {
                    buttonElement.classList.remove('active');
                    const heartIcon = buttonElement.querySelector('i');
                    heartIcon.className = 'bi bi-heart';
                    
                    // Animasi
                    anime({
                        targets: heartIcon,
                        scale: [1, 0.5, 1],
                        duration: 300
                    });
                }
                
                // NOTIFIKASI IMPROVED: Event dihapus dari wishlist
                showNotification(`"${eventData.title}" dihapus dari wishlist`, 'info');
            } else {
                // Tambah ke wishlist
                wishlist.push(eventId);
                
                // Update button
                if (buttonElement) {
                    buttonElement.classList.add('active');
                    const heartIcon = buttonElement.querySelector('i');
                    heartIcon.className = 'bi bi-heart-fill';
                    
                    // Animasi
                    anime({
                        targets: heartIcon,
                        scale: [1, 1.3, 1],
                        duration: 300,
                        easing: 'easeInOutQuad'
                    });
                }
                
                // NOTIFIKASI IMPROVED: Event ditambahkan ke wishlist
                showNotification(` "${eventData.title}" ditambahkan ke wishlist!`, 'success');
            }
            
            // Simpan ke localStorage
            localStorage.setItem(`wishlist_${currentUser.id}`, JSON.stringify(wishlist));
            
            // Hapus class animating setelah selesai
            setTimeout(() => {
                if (buttonElement) {
                    buttonElement.classList.remove('animating');
                }
            }, 600);
            
            // Update semua tampilan yang relevan
            updateWishlistDisplay();
        }

        // Event Detail in MODAL - IMPROVED WITH FULL IMAGE
        function showEventDetailModal(eventId) {
            const event = eventsData.find(e => e.id === eventId);
            if (!event) return;

            currentEventDetail = event;
            const isRegistered = registeredEvents.some(e => e.id === eventId);
            const isQuotaFull = event.registered >= event.quota;
            const isInWishlist = wishlist.includes(event.id);
            const quotaPercentage = (event.registered / event.quota) * 100;
            const remaining = event.quota - event.registered;
            
            // Set modal title
            document.getElementById('modalEventTitle').textContent = event.title;
            
            // Set modal body content 
            document.getElementById('modalEventBody').innerHTML = `
                <div style="position: relative;">
                    <img src="${event.image}" class="img-fluid rounded mb-3" alt="${event.title}" 
                         style="width: 100%; height: auto; object-fit: contain; max-height: 400px; background: #f5f5f5;">
                    <span class="event-badge" style="position: absolute; top: 15px; left: 15px;">${event.category}</span>
                    <button class="wishlist-btn ${isInWishlist ? 'active' : ''}" 
                            style="position: absolute; top: 15px; right: 15px; z-index: 1060;"
                            onclick="toggleWishlistFromModal(${event.id}, this)">
                        <i class="bi ${isInWishlist ? 'bi-heart-fill' : 'bi-heart'}"></i>
                    </button>
                </div>
                
                <h6 class="mt-3 mb-2" style="font-weight: 600;">Deskripsi</h6>
                <p style="text-align: justify; line-height: 1.6;">${event.description}</p>
                
                <h6 class="mt-4 mb-3" style="font-weight: 600;">Detail Event</h6>
                
                <div class="mb-2">
                    <i class="bi bi-calendar3 me-2" style="color: var(--secondary);"></i>
                    <strong>Tanggal:</strong> ${event.date}
                </div>
                
                <div class="mb-2">
                    <i class="bi bi-geo-alt-fill me-2" style="color: var(--secondary);"></i>
                    <strong>Lokasi:</strong> ${event.location}
                </div>
                
                <div class="mb-2">
                    <i class="bi bi-tag-fill me-2" style="color: var(--secondary);"></i>
                    <strong>Harga:</strong> ${event.price}
                </div>
                
                <div class="mb-3">
                    <i class="bi bi-people-fill me-2" style="color: var(--secondary);"></i>
                    <strong>Kuota:</strong> ${event.quota} peserta
                    <div class="progress mt-2" style="height: 8px; border-radius: 10px;">
                        <div class="progress-bar" role="progressbar" style="width: ${quotaPercentage}%; background: ${quotaPercentage >= 90 ? '#ff4757' : quotaPercentage >= 70 ? '#ffa502' : 'var(--secondary)'};"></div>
                    </div>
                    <small class="text-muted">${event.registered} terdaftar  ${remaining} kuota tersisa</small>
                </div>
                
                <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-star-fill" style="color: #ffd700;"></i>
                    <span style="font-weight: 600;">${event.rating}</span>
                    <span class="text-muted" style="font-size: 14px;">(${event.reviews} ulasan)</span>
                </div>
            `;

            // Set modal footer dengan tombol yang sesuai
            let footerHTML = '<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>';

            // Add Chat button
            footerHTML += '<button type="button" class="btn btn-info" onclick="openChat(' + event.id + '); bootstrap.Modal.getInstance(document.getElementById(\'eventDetailModal\')).hide();"><i class="bi bi-chat-dots"></i> Chat</button>';

            // Check if already registered or quota full
            if (isRegistered) {
                footerHTML += `
                    <button type="button" class="btn btn-success" disabled>
                        <i class="bi bi-check-circle"></i> Sudah Terdaftar
                    </button>
                    <button type="button" class="btn btn-danger" onclick="cancelRegistration(${event.id})">
                        <i class="bi bi-x-circle"></i> Batalkan
                    </button>
                `;
            } else if (isQuotaFull) {
                footerHTML += '<button type="button" class="btn btn-danger" disabled><i class="bi bi-x-circle"></i> Kuota Penuh</button>';
            } else {
                if (event.price === 'Gratis') {
                    footerHTML += `<button type="button" class="btn btn-primary" onclick="registerEventFromModal()">
                        <i class="bi bi-ticket"></i> Daftar Gratis
                    </button>`;
                } else {
                    footerHTML += `<button type="button" class="btn btn-warning" onclick="startPaymentProcess()">
                        <i class="bi bi-ticket"></i> Beli Tiket
                    </button>`;
                }
            }

            document.getElementById('modalEventFooter').innerHTML = footerHTML;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('eventDetailModal'));
            modal.show();
        }

        // Batalkan Pendaftaran - FIXED
        function cancelRegistration(eventId) {
            const event = eventsData.find(e => e.id === eventId);
            if (!event) return;

            if (!confirm(`Batalkan pendaftaran untuk "${event.title}"?`)) return;

            const index = registeredEvents.findIndex(e => e.id === eventId);
            if (index > -1) {
                registeredEvents.splice(index, 1);
                localStorage.setItem(`registered_${currentUser.id}`, JSON.stringify(registeredEvents));

                if (event) {
                    event.registered = Math.max(0, event.registered - 1);
                }

                bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
                showNotification(`Pendaftaran untuk "${event.title}" telah dibatalkan`, 'warning');
                renderReminder();
            }
        }

        // Toggle Wishlist dari Modal - PERBAIKAN BESAR
        function toggleWishlistFromModal(eventId, buttonElement) {
            if (!currentEventDetail) return;
            
            const isInWishlist = wishlist.includes(eventId);
            const eventData = eventsData.find(e => e.id === eventId);
            
            // Hentikan event bubbling
            event.stopPropagation();
            
            // Tambahkan class animating
            buttonElement.classList.add('animating');
            
            if (isInWishlist) {
                wishlist = wishlist.filter(id => id !== eventId);
                buttonElement.classList.remove('active');
                const heartIcon = buttonElement.querySelector('i');
                heartIcon.className = 'bi bi-heart';
                showNotification(`"${eventData.title}" dihapus dari wishlist`, 'info');
            } else {
                wishlist.push(eventId);
                buttonElement.classList.add('active');
                const heartIcon = buttonElement.querySelector('i');
                heartIcon.className = 'bi bi-heart-fill';
                showNotification(` "${eventData.title}" ditambahkan ke wishlist!`, 'success');
            }
            
            localStorage.setItem(`wishlist_${currentUser.id}`, JSON.stringify(wishlist));
            
            // Update card di halaman home
            const wishlistBtn = document.querySelector(`.event-card[onclick*="${eventId}"] .wishlist-btn`);
            if (wishlistBtn) {
                if (isInWishlist) {
                    wishlistBtn.classList.remove('active');
                    wishlistBtn.querySelector('i').className = 'bi bi-heart';
                } else {
                    wishlistBtn.classList.add('active');
                    wishlistBtn.querySelector('i').className = 'bi bi-heart-fill';
                }
            }
            
            // Hapus class animating setelah selesai
            setTimeout(() => {
                buttonElement.classList.remove('animating');
            }, 600);
        }

        // Register Event dari Modal (untuk event gratis)
        function registerEventFromModal() {
            if (!currentEventDetail) return;
            
            const event = eventsData.find(e => e.id === currentEventDetail.id);
            const isRegistered = registeredEvents.some(e => e.id === currentEventDetail.id);
            
            if (isRegistered) {
                alert('Anda sudah terdaftar di event ini!');
                return;
            }

            if (event.registered >= event.quota) {
                alert('Maaf, kuota event sudah penuh! \n\nSilakan coba event lainnya atau tambahkan ke wishlist untuk mendapat notifikasi jika ada slot tersedia.');
                return;
            }

            const confirmMsg = `Konfirmasi Pendaftaran\n\nEvent: ${event.title}\nTanggal: ${event.date}\nLokasi: ${event.location}\nHarga: ${event.price}\n\nLanjutkan pendaftaran?`;
            
            if (!confirm(confirmMsg)) return;

            const ticketCode = `EVT-FREE-${Date.now().toString().slice(-8)}`;
            
            const registration = {
                ...event,
                registeredAt: new Date().toISOString(),
                paymentStatus: 'free',
                ticketCode: ticketCode
            };

            event.registered += 1;
            registeredEvents.push(registration);
            localStorage.setItem(`registered_${currentUser.id}`, JSON.stringify(registeredEvents));
            
            bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();

            // Tampilkan QR Tiket
            currentTicketData = registration;
            showTicketQR();
            
            showNotification(` Berhasil mendaftar ${event.title}!`, 'success');
            renderReminder();
        }

        // Fungsi untuk menampilkan QR Tiket - PERBAIKAN BESAR
        function showTicketQR() {
            if (!currentTicketData) return;
            
            const ticketData = currentTicketData;
            const event = eventsData.find(e => e.id === ticketData.id) || ticketData;
            
            // Data untuk QR Code
            const qrData = JSON.stringify({
                type: 'event_ticket',
                eventId: event.id,
                ticketCode: ticketData.ticketCode,
                eventTitle: event.title,
                userName: currentUser.name,
                purchaseDate: new Date().toISOString()
            });
            
            document.getElementById('ticketContent').innerHTML = `
                <div class="ticket-qr-container">
                    <div class="text-center mb-4">
                        <h4 class="mb-2"> ${event.title}</h4>
                        <span class="badge bg-warning text-dark">${event.category.toUpperCase()}</span>
                    </div>
                    
                    <div class="ticket-qr-display">
                        <div class="ticket-qr-code" id="qrcode">
                            <div class="qr-loading">
                                <div class="spinner"></div>
                                <p>Membuat QR Code...</p>
                            </div>
                        </div>
                        <div class="mt-3">
                            
                            <small class="text-muted">Scan QR Code untuk verifikasi</small>
                        </div>
                    </div>
                    
                    <div class="ticket-details">
                        <h6 class="mb-3"><i class="bi bi-person-badge"></i> Data Peserta</h6>
                        <div class="ticket-field">
                            <span class="label">Nama Lengkap:</span>
                            <span class="value">${currentUser.name}</span>
                        </div>
                        <div class="ticket-field">
                            <span class="label">Email:</span>
                            <span class="value">${currentUser.email}</span>
                        </div>
                        <div class="ticket-field">
                            <span class="label">Status:</span>
                            <span class="value text-success"> Terdaftar & Aktif</span>
                        </div>
                        
                        <h6 class="mt-4 mb-3"><i class="bi bi-calendar-event"></i> Detail Event</h6>
                        <div class="ticket-field">
                            <span class="label">Tanggal:</span>
                            <span class="value">${event.date}</span>
                        </div>
                        <div class="ticket-field">
                            <span class="label">Lokasi:</span>
                            <span class="value">${event.location}</span>
                        </div>
                        <div class="ticket-field">
                            <span class="label">Penyelenggara:</span>
                            <span class="value">${event.organizer}</span>
                        </div>
                        <div class="ticket-field">
                            <span class="label">Harga Tiket:</span>
                            <span class="value">${event.price}</span>
                        </div>
                        <div class="ticket-field">
                            <span class="label">Pembelian:</span>
                            <span class="value">${new Date(ticketData.registeredAt).toLocaleDateString('id-ID', {
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            })}</span>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 rounded" style="background: rgba(40, 167, 69, 0.1);">
                        <h6><i class="bi bi-shield-check"></i> Instruksi Keamanan</h6>
                        <small class="text-muted">
                             QR Code bersifat pribadi dan unik<br>
                             Hanya berlaku untuk 1 (satu) kali scan<br>
                             Jangan bagikan screenshot QR Code<br>
                             Pastikan baterai ponsel cukup untuk display QR
                        </small>
                    </div>
                </div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('ticketModal'));
            modal.show();
            
            // Generate QR Code setelah modal ditampilkan
            setTimeout(() => {
                if (typeof QRCode !== 'undefined') {
                    // Hapus loading dan generate QR Code
                    const qrcodeElement = document.getElementById("qrcode");
                    qrcodeElement.innerHTML = "";
                    
                    try {
                        new QRCode(qrcodeElement, {
                            text: qrData,
                            width: 170,
                            height: 170,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        
                        // Pastikan canvas ditampilkan dengan benar
                        const canvas = qrcodeElement.querySelector('canvas');
                        if (canvas) {
                            canvas.style.width = '170px';
                            canvas.style.height = '170px';
                        }
                    } catch (error) {
                        console.error('Error generating QR code:', error);
                        // Fallback jika QR Code gagal
                        qrcodeElement.innerHTML = `
    <div style="text-align: center; padding: 30px;">
        <div style="font-size: 80px; color: #666;">
            <i class="bi bi-qr-code"></i>
        </div>
        <p class="mt-3" style="font-family: monospace; font-size: 14px;">
            ${ticketData.ticketCode}
        </p>
    </div>
`;
                    }
                } else {
                    // Fallback jika QRCode.js tidak tersedia
                    document.getElementById("qrcode").innerHTML = `
                        <div style="text-align: center; padding: 30px;">
                            <div style="font-size: 80px; color: #666;">
                                 <i class="bi bi-qr-code"></i>
                                 </div>
                            <p class="mt-3" style="font-family: monospace; font-size: 14px;">${ticketData.ticketCode}</p>
                            
                        </div>
                    `;
                }
            }, 500);
        }

        // Fungsi untuk mendownload tiket
        function downloadTicket() {
            if (!currentTicketData) return;
            
            showNotification(' Sedang mempersiapkan tiket untuk diunduh...', 'info');
            
            const ticketContent = `
                TIKET EVENT - ${currentTicketData.title}
                
                Kode Tiket: ${currentTicketData.ticketCode}
                Nama Peserta: ${currentUser.name}
                Email: ${currentUser.email}
                
                DETAIL EVENT:
                - Event: ${currentTicketData.title}
                - Tanggal: ${currentTicketData.date}
                - Lokasi: ${currentTicketData.location}
                - Kategori: ${currentTicketData.category}
                - Penyelenggara: ${currentTicketData.organizer}
                
                INFORMASI:
                 Tiket ini bersifat pribadi dan tidak dapat dialihkan
                 Tunjukkan QR Code saat check-in
                 Datang 30 menit sebelum event dimulai
                
                Terima kasih telah menggunakan Eventraze!
            `;
            
            const blob = new Blob([ticketContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `Tiket-${currentTicketData.title.replace(/\s+/g, '_')}-${currentTicketData.ticketCode}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification(` Tiket "${currentTicketData.title}" berhasil diunduh!`, 'success');
        }

        // Fungsi untuk share tiket
        function shareTicket() {
            if (!currentTicketData) return;
            
            const shareText = ` Saya telah terdaftar di "${currentTicketData.title}" melalui Eventraze!\n\nKode Tiket: ${currentTicketData.ticketCode}\nTanggal: ${currentTicketData.date}\nLokasi: ${currentTicketData.location}\n\nDapatkan pengalaman event terbaik di Eventraze!`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Tiket ${currentTicketData.title}`,
                    text: shareText,
                    url: window.location.href
                }).then(() => {
                    showNotification(' Tiket berhasil dibagikan!', 'success');
                }).catch(err => {
                    console.log('Error sharing:', err);
                    copyToClipboard(shareText);
                    showNotification(' Detail tiket disalin ke clipboard!', 'info');
                });
            } else {
                copyToClipboard(shareText);
                showNotification(' Detail tiket berhasil disalin ke clipboard!', 'success');
            }
        }

        // Fungsi copy ke clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        // Show My Tickets
        function showMyTickets() {
            const ticketsList = document.getElementById('myTicketsList');
            
            if (registeredEvents.length === 0) {
                ticketsList.innerHTML = `
                    <div class="empty-tickets">
                        <i class="bi bi-ticket-perforated"></i>
                        <h5 class="mt-3">Belum Ada Tiket</h5>
                        <p class="text-muted">Anda belum mendaftar event apapun</p>
                        <button class="btn btn-primary mt-3" 
                                onclick="bootstrap.Modal.getInstance(document.getElementById('myTicketsModal')).hide(); 
                                         showMainPage('homePage')">
                            <i class="bi bi-calendar-event"></i> Cari Event
                        </button>
                    </div>
                `;
            } else {
                ticketsList.innerHTML = `
                    <div class="tickets-grid">
                        ${registeredEvents.map(ticket => {
                            const event = eventsData.find(e => e.id === ticket.id) || ticket;
                            const ticketDate = new Date(ticket.registeredAt);
                            const formattedDate = ticketDate.toLocaleDateString('id-ID', {
                                weekday: 'long',
                                day: 'numeric',
                                month: 'long',
                                year: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                            
                            return `
                                <div class="ticket-card">
                                    <div class="ticket-header">
                                        <div style="flex: 1;">
                                            <h6 class="mb-2" style="font-weight: 600; line-height: 1.3;">${event.title}</h6>
                                           
                                        </div>
                                        <div class="ticket-status ${ticket.paymentStatus === 'free' ? 'free' : 'paid'}">
                                            ${ticket.paymentStatus === 'free' ? 'Gratis' : 'Berbayar'}
                                        </div>
                                    </div>
                                    
                                    <div class="ticket-details">
                                        <div class="ticket-detail-item">
                                            <i class="bi bi-calendar"></i>
                                            <span><strong>Tanggal Event:</strong> ${event.date}</span>
                                        </div>
                                        <div class="ticket-detail-item">
                                            <i class="bi bi-geo-alt"></i>
                                            <span><strong>Lokasi:</strong> ${event.location}</span>
                                        </div>
                                        <div class="ticket-detail-item">
                                            <i class="bi bi-cash"></i>
                                            <span><strong>Harga:</strong> ${event.price}</span>
                                        </div>
                                    </div>
                                    
                                    <div class="ticket-actions">
                                        <button class="ticket-action-btn primary" onclick="showTicketFromProfile(${ticket.id})">
                                            <i class="bi bi-qr-code"></i> QR Tiket
                                        </button>
                                        <button class="ticket-action-btn secondary" onclick="showEventDetailModal(${ticket.id})">
                                            <i class="bi bi-info-circle"></i> Detail
                                        </button>
                                    </div>
                                    
                                    <div class="ticket-footer">
                                        <span><i class="bi bi-clock"></i> Terdaftar: ${formattedDate}</span>
                                        <span class="text-success">
                                            <i class="bi bi-check-circle"></i> Aktif
                                        </span>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div class="mt-4 p-3 rounded" style="background: rgba(247, 197, 102, 0.1);">
                        <h6><i class="bi bi-info-circle"></i> Informasi Tiket</h6>
                        <small class="text-muted">
                            1. Tiket hanya berlaku untuk peserta yang terdaftar<br>
                            2. Tunjukkan QR Code saat check-in di lokasi event<br>
                            3. Jangan bagikan QR Code kepada siapapun<br>
                            4. Pastikan data diri sesuai dengan identitas
                        </small>
                    </div>
                `;
            }
            
            const modal = new bootstrap.Modal(document.getElementById('myTicketsModal'));
            modal.show();
        }
        
        // Show Ticket from Profile
        function showTicketFromProfile(eventId) {
            const registration = registeredEvents.find(e => e.id === eventId);
            if (!registration) {
                showNotification('Tiket tidak ditemukan!', 'error');
                return;
            }
            
            currentTicketData = registration;
            
            // Tutup modal tiket saya
            const myTicketsModal = bootstrap.Modal.getInstance(document.getElementById('myTicketsModal'));
            if (myTicketsModal) {
                myTicketsModal.hide();
                
                // Tampilkan QR tiket setelah modal tertutup
                setTimeout(() => {
                    showTicketQR();
                }, 500);
            } else {
                // Jika modal tidak terbuka, langsung tampilkan QR
                showTicketQR();
            }
        }

        // ============================
        // PAYMENT FUNCTIONS
        // ============================
        function startPaymentProcess() {
            if (!currentEventDetail) return;
            
            const event = eventsData.find(e => e.id === currentEventDetail.id);
            const isRegistered = registeredEvents.some(e => e.id === currentEventDetail.id);
            
            if (isRegistered) {
                alert('Anda sudah terdaftar di event ini!');
                return;
            }

            if (event.registered >= event.quota) {
                alert('Maaf, kuota event sudah penuh!');
                return;
            }

            bootstrap.Modal.getInstance(document.getElementById('eventDetailModal')).hide();
            setTimeout(() => showPaymentModal(), 300);
        }

        function showPaymentModal() {
            if (!currentEventDetail) return;
            
            document.getElementById('paymentContent').innerHTML = `
                <div class="payment-steps">
                    <div class="payment-step active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-title">Pilih Metode</div>
                    </div>
                    <div class="payment-step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-title">Bayar</div>
                    </div>
                    <div class="payment-step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-title">Selesai</div>
                    </div>
                </div>

                <div id="paymentStep1">
                    <h6>Detail Event</h6>
                    <div class="payment-summary">
                        <div class="summary-item">
                            <span>${currentEventDetail.title}</span>
                            <span>${currentEventDetail.price}</span>
                        </div>
                        <div class="summary-item">
                            <span>Biaya Admin</span>
                            <span>Rp 2.000</span>
                        </div>
                        <div class="summary-item total">
                            <span>Total Pembayaran</span>
                            <span id="totalAmount">${calculateTotal(currentEventDetail.price)}</span>
                        </div>
                    </div>

                    <h6 class="mt-4">Pilih Metode Pembayaran</h6>
                    <div class="payment-methods" id="paymentMethods">
                        <div class="payment-method" onclick="selectPaymentMethod('qris', this)">
                            <i class="bi bi-qr-code-scan"></i>
                            <div>QRIS</div>
                            <small class="text-muted">Scan QR Code</small>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod('gopay', this)">
                            <i class="bi bi-phone"></i>
                            <div>Gopay</div>
                            <small class="text-muted">0857-XXXX-XXXX</small>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod('dana', this)">
                            <i class="bi bi-wallet2"></i>
                            <div>DANA</div>
                            <small class="text-muted">0857-XXXX-XXXX</small>
                        </div>
                    </div>

                    <button class="btn btn-primary w-100 mt-4" onclick="goToPaymentStep2()" id="nextBtn" disabled>
                        Lanjut ke Pembayaran
                    </button>
                </div>

                <div id="paymentStep2" style="display:none;"></div>
                <div id="paymentStep3" style="display:none;"></div>
            `;
            
            const modal = new bootstrap.Modal(document.getElementById('paymentModal'));
            modal.show();
        }

        function selectPaymentMethod(method, element) {
            selectedPaymentMethod = method;
            
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            element.classList.add('selected');
            document.getElementById('nextBtn').disabled = false;
            
            anime({
                targets: element,
                scale: [1, 1.05, 1],
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        function calculateTotal(price) {
            if (price === 'Gratis') return 'Gratis';
            const priceNum = parseInt(price.replace(/\D/g, '')) || 0;
            const total = priceNum + 2000;
            return `Rp ${total.toLocaleString('id-ID')}`;
        }

        function goToPaymentStep2() {
            if (!selectedPaymentMethod) {
                alert('Pilih metode pembayaran terlebih dahulu!');
                return;
            }
            
            document.getElementById('step1').classList.remove('active');
            document.getElementById('step1').classList.add('completed');
            document.getElementById('step2').classList.add('active');
            
            document.getElementById('paymentStep1').style.display = 'none';
            
            const paymentContent = `
                <div class="text-center">
                    <h6>Scan QR Code untuk Membayar</h6>
                    <p class="text-muted">Gunakan aplikasi mobile banking/e-wallet untuk scan</p>
                    
                    <div class="qr-code-container">
                        <div class="qr-code">
                            <i class="bi bi-qr-code"></i>
                        </div>
                        <div class="payment-timer" id="paymentTimer">05:00</div>
                        <p class="text-muted">Batas waktu pembayaran</p>
                    </div>
                    
                    <div class="payment-instruction">
                        <strong>Cara Bayar:</strong><br>
                        1. Buka aplikasi e-wallet/banking<br>
                        2. Pilih "Scan QR Code"<br>
                        3. Arahkan kamera ke QR code di atas<br>
                        4. Konfirmasi pembayaran
                    </div>
                    
                    <div class="d-flex gap-2 mt-4">
                        <button class="btn btn-secondary flex-fill" onclick="goBackToStep1()">
                            <i class="bi bi-arrow-left"></i> Kembali
                        </button>
                        <button class="btn btn-success flex-fill" onclick="simulatePayment()">
                            <i class="bi bi-check-circle"></i> Simulasikan
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('paymentStep2').innerHTML = paymentContent;
            document.getElementById('paymentStep2').style.display = 'block';
            
            startPaymentTimer();
        }

        function goBackToStep1() {
            document.getElementById('step1').classList.add('active');
            document.getElementById('step1').classList.remove('completed');
            document.getElementById('step2').classList.remove('active');
            
            document.getElementById('paymentStep2').style.display = 'none';
            document.getElementById('paymentStep1').style.display = 'block';
            
            clearInterval(paymentTimerInterval);
        }

        function startPaymentTimer() {
            clearInterval(paymentTimerInterval);
            paymentTimer = 300;
            
            updateTimerDisplay();
            
            paymentTimerInterval = setInterval(() => {
                paymentTimer--;
                updateTimerDisplay();
                
                if (paymentTimer <= 0) {
                    clearInterval(paymentTimerInterval);
                    showPaymentTimeout();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(paymentTimer / 60);
            const seconds = paymentTimer % 60;
            const timerElement = document.getElementById('paymentTimer');
            
            if (timerElement) {
                timerElement.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (paymentTimer < 60) {
                    timerElement.style.color = '#ff4757';
                }
            }
        }

        function showPaymentTimeout() {
            document.getElementById('paymentStep2').innerHTML = `
                <div class="text-center py-4">
                    <i class="bi bi-clock-history" style="font-size: 64px; color: #ff4757;"></i>
                    <h5 class="mt-3">Waktu Pembayaran Habis</h5>
                    <p class="text-muted">Sesi pembayaran telah berakhir.</p>
                    <button class="btn btn-primary mt-3" onclick="goBackToStep1()">
                        Coba Lagi
                    </button>
                </div>
            `;
        }

        function simulatePayment() {
            clearInterval(paymentTimerInterval);
            
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step2').classList.add('completed');
            document.getElementById('step3').classList.add('active');
            
            document.getElementById('paymentStep2').style.display = 'none';
            
            document.getElementById('paymentStep3').innerHTML = `
                <div class="payment-success">
                    <i class="bi bi-check-circle-fill"></i>
                    <h4>Pembayaran Berhasil!</h4>
                    <p class="text-muted">Tiket event telah dikirim ke email Anda</p>
                    
                    <div class="payment-summary mt-4">
                        <div class="summary-item">
                            <span>Kode Tiket</span>
                            <span class="fw-bold">EVT-${Date.now().toString().slice(-8)}</span>
                        </div>
                        <div class="summary-item">
                            <span>Event</span>
                            <span>${currentEventDetail.title}</span>
                        </div>
                        <div class="summary-item">
                            <span>Tanggal</span>
                            <span>${currentEventDetail.date}</span>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
    <button class="btn-unduh">
        <i class="bi bi-download"></i> Unduh Tiket
    </button>

    <button class="btn-selesai">
        <i class="bi bi-check"></i> Selesai
    </button>
</div>

                </div>
            `;
            
            document.getElementById('paymentStep3').style.display = 'block';
        }

        function completeRegistrationAfterPayment() {
            if (!currentEventDetail) return;
            
            const event = eventsData.find(e => e.id === currentEventDetail.id);
            const ticketCode = `EVT-PAID-${Date.now().toString().slice(-8)}`;
            
            const registration = {
                ...event,
                registeredAt: new Date().toISOString(),
                paymentStatus: 'paid',
                ticketCode: ticketCode
            };

            event.registered += 1;
            registeredEvents.push(registration);
            localStorage.setItem(`registered_${currentUser.id}`, JSON.stringify(registeredEvents));
            
            bootstrap.Modal.getInstance(document.getElementById('paymentModal')).hide();
            
            // Tampilkan QR Tiket setelah pembayaran
            currentTicketData = registration;
            setTimeout(() => showTicketQR(), 500);
            
            showNotification(` Tiket "${event.title}" telah tersedia!`, 'success');
            renderReminder();
        }

        // ============================
        // CHAT FUNCTIONS
        // ============================
        function openChat(eventId) {
            const event = eventsData.find(e => e.id === eventId);
            if (!event) return;
            
            currentChatEvent = event;
            document.getElementById('chatEventTitle').textContent = event.title;
            document.getElementById('userNameChat').textContent = currentUser?.name || 'User';
            document.getElementById('userAvatarChat').textContent = (currentUser?.name?.charAt(0) || 'U').toUpperCase();
            
            showPage('chatPage');
            renderChat();
            
            if (!chatInitialized) {
                setTimeout(() => {
                    const welcomeMsg = {
                        id: Date.now(),
                        user: 'System',
                        message: `Selamat datang di chat "${event.title}". Chat ini tersedia untuk peserta terdaftar.`,
                        time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                        isOwn: false,
                        type: 'system'
                    };
                    
                    const existingWelcome = chatMessages.find(msg => 
                        msg.user === 'System' && msg.message.includes('Selamat datang')
                    );
                    
                    if (!existingWelcome) {
                        chatMessages.push(welcomeMsg);
                        localStorage.setItem(`chat_${currentUser.id}`, JSON.stringify(chatMessages.slice(-100)));
                        renderChat();
                    }
                    
                    chatInitialized = true;
                }, 1000);
            }
        }

        function renderChat() {
            const chatMessagesDiv = document.getElementById('chatMessages');
            if (!chatMessagesDiv) return;
            
            chatMessagesDiv.innerHTML = '';
            
            if (chatMessages.length === 0) {
                chatMessages = [
                    {
                        id: 1,
                        user: 'Event Organizer',
                        message: `Selamat datang di chat "${currentChatEvent?.title || 'Event'}". Ada yang bisa kami bantu?`,
                        time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                        isOwn: false
                    }
                ];
                localStorage.setItem(`chat_${currentUser.id}`, JSON.stringify(chatMessages));
            }
            
            chatMessagesDiv.innerHTML = chatMessages.map((msg, index) => {
                let messageContent = '';
                
                if (msg.type === 'file') {
                    messageContent = `
                        <div class="file-preview">
                            <div class="file-icon">
                                <i class="bi bi-file-earmark"></i>
                            </div>
                            <div class="file-info">
                                <div class="file-name">${msg.file?.name || 'File'}</div>
                                <div class="file-size">${msg.file?.size || '0 KB'}</div>
                            </div>
                            <button class="download-btn" onclick="downloadChatFile(${index})">
                                <i class="bi bi-download"></i>
                            </button>
                        </div>
                    `;
                } else {
                    messageContent = msg.message || '';
                }
                
                return `
                    <div class="message ${msg.isOwn ? 'own' : ''} ${msg.type || ''}">
                        ${!msg.isOwn ? `
                            <div class="message-avatar">${msg.user?.charAt(0) || 'U'}</div>
                        ` : ''}
                        <div>
                            <div class="message-content">
                                ${!msg.isOwn ? `<div class="message-name">${msg.user || 'User'}</div>` : ''}
                                <div>${messageContent}</div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="message-time">${msg.time || ''}</div>
                                    ${msg.isOwn ? `
                                        <div class="message-status">
                                            <i class="bi bi-check"></i>
                                            <span>Terkirim</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        ${msg.isOwn ? `
                            <div class="message-avatar">${msg.user?.charAt(0) || 'U'}</div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
            
            // Update participants count
            const onlineCount = Math.floor(Math.random() * 10) + 3;
            const participantsElement = document.getElementById('chatParticipantsCount');
            if (participantsElement) {
                participantsElement.textContent = `${onlineCount} peserta online`;
            }
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            const newMessage = {
                id: Date.now(),
                user: currentUser.name,
                message: message,
                time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                isOwn: true
            };

            chatMessages.push(newMessage);
            localStorage.setItem(`chat_${currentUser.id}`, JSON.stringify(chatMessages.slice(-100)));
            input.value = '';
            renderChat();

            // Show typing indicator
            showTypingIndicator();
            
            // Simulate response
            setTimeout(() => {
                const responses = [
                    'Terima kasih atas pertanyaannya! Tim kami akan segera merespons.',
                    'Pertanyaan Anda telah dicatat. Tunggu sebentar ya.',
                    'Saya akan menghubungkan panitia untuk jawaban yang tepat.'
                ];
                
                const autoReply = {
                    id: Date.now() + 1,
                    user: 'Event Organizer',
                    message: responses[Math.floor(Math.random() * responses.length)],
                    time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                    isOwn: false
                };
                
                chatMessages.push(autoReply);
                localStorage.setItem(`chat_${currentUser.id}`, JSON.stringify(chatMessages.slice(-100)));
                renderChat();
            }, 2000);
        }

        function sendQuickReply(text) {
            document.getElementById('chatInput').value = text;
            sendMessage();
            
            anime({
                targets: event.target,
                scale: [1, 0.95, 1],
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*,.pdf,.doc,.docx,.txt';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                if (fileSize > 5) {
                    showNotification(' File terlalu besar! Maksimal 5MB', 'warning');
                    return;
                }
                
                sendFileMessage(file);
            };
            
            input.click();
        }

        function sendFileMessage(file) {
            if (!file) return;
            
            const fileName = file.name;
            const fileSize = formatFileSize(file.size);
            
            const newMessage = {
                id: Date.now(),
                user: currentUser.name,
                message: '',
                time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                isOwn: true,
                type: 'file',
                file: {
                    name: fileName,
                    size: fileSize
                }
            };
            
            chatMessages.push(newMessage);
            localStorage.setItem(`chat_${currentUser.id}`, JSON.stringify(chatMessages.slice(-100)));
            renderChat();
            
            showTypingIndicator();
            
            setTimeout(() => {
                const responses = [
                    'Terima kasih telah mengirim file. Tim kami akan meninjau.',
                    'File telah diterima. Apakah ada yang ingin ditanyakan?'
                ];
                
                const autoReply = {
                    id: Date.now() + 1,
                    user: 'Event Organizer',
                    message: responses[Math.floor(Math.random() * responses.length)],
                    time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                    isOwn: false
                };
                
                chatMessages.push(autoReply);
                localStorage.setItem(`chat_${currentUser.id}`, JSON.stringify(chatMessages.slice(-100)));
                renderChat();
            }, 2000);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showTypingIndicator() {
            const chatMessagesDiv = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.innerHTML = `
                <span>Organizer mengetik</span>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            
            chatMessagesDiv.appendChild(typingDiv);
            chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
            
            setTimeout(() => {
                typingDiv.remove();
            }, 1500);
        }

        function downloadChatFile(messageIndex) {
            const msg = chatMessages[messageIndex];
            if (!msg || !msg.file) return;
            
            showNotification(` Mengunduh "${msg.file.name}"...`, 'info');
            
            setTimeout(() => {
                showNotification(` "${msg.file.name}" berhasil diunduh!`, 'success');
            }, 1500);
        }

        // Render Reminder with Notifications Tab
        function renderReminder() {
            renderNotifications();
            renderWishlist();
            renderRegistered();
            renderHistory();
        }

        function switchReminderTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');

            if (tab === 'notifikasi') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('notifikasiTab').style.display = 'block';
                renderNotifications();
            } else if (tab === 'wishlist') {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('wishlistTab').style.display = 'block';
                renderWishlist();
            } else if (tab === 'registered') {
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                document.getElementById('registeredTab').style.display = 'block';
                renderRegistered();
            } else if (tab === 'history') {
                document.querySelectorAll('.tab-btn')[3].classList.add('active');
                document.getElementById('historyTab').style.display = 'block';
                renderHistory();
            }
        }

        // Render Notifications List
        function renderNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            if (notificationHistory.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-bell-slash"></i>
                        <p>Belum ada notifikasi</p>
                        <small class="text-muted">Notifikasi akan muncul di sini</small>
                    </div>
                `;
                return;
            }

            const grouped = {};
            const sortedNotifications = [...notificationHistory].reverse();
            
            sortedNotifications.forEach(notif => {
                const date = new Date(notif.timestamp);
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                let dateKey;
                if (date.toDateString() === today.toDateString()) {
                    dateKey = 'Hari Ini';
                } else if (date.toDateString() === yesterday.toDateString()) {
                    dateKey = 'Kemarin';
                } else {
                    dateKey = date.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                }
                
                if (!grouped[dateKey]) {
                    grouped[dateKey] = [];
                }
                grouped[dateKey].push(notif);
            });

            let html = '';
            Object.keys(grouped).forEach((dateKey, groupIndex) => {
                html += `
                    <div class="mb-3">
                        <h6 class="px-2 py-2 text-muted" style="font-size: 13px; font-weight: 600;">${dateKey}</h6>
                `;
                
                grouped[dateKey].forEach((notif, index) => {
                    const timeAgo = getTimeAgo(new Date(notif.timestamp));
                    const iconMap = {
                        success: '',
                        info: '',
                        warning: '',
                        error: '',
                        reminder: '',
                        event: ''
                    };
                    
                    const isUnread = groupIndex === 0 && index < 3;
                    
                    html += `
                        <div class="notification-item ${isUnread ? 'notification-unread' : ''}" onclick="markAsRead(this)">
                            <div class="notification-icon ${notif.type}">
                                ${iconMap[notif.type] || ''}
                            </div>
                            <div class="notification-content">
                                <div style="line-height: 1.5;">${notif.message}</div>
                                <div class="notification-time">${timeAgo}</div>
                            </div>
                            ${isUnread ? '<div class="notification-badge"></div>' : ''}
                        </div>
                    `;
                });
                
                html += `</div>`;
            });

            html += `
                <div class="text-center mt-4 mb-3">
                    <button class="btn btn-sm btn-outline-secondary" onclick="clearAllNotifications()">
                        <i class="bi bi-trash"></i> Hapus Semua Notifikasi
                    </button>
                </div>
            `;

            notificationsList.innerHTML = html;
        }

        function markAsRead(element) {
            element.classList.remove('notification-unread');
            const badge = element.querySelector('.notification-badge');
            if (badge) {
                anime({
                    targets: badge,
                    opacity: [1, 0],
                    scale: [1, 0],
                    duration: 300,
                    easing: 'easeOutQuad',
                    complete: () => badge.remove()
                });
            }
        }

        function clearAllNotifications() {
            if (confirm('Hapus semua notifikasi?')) {
                notificationHistory = [];
                localStorage.setItem(`notifications_${currentUser.id}`, JSON.stringify(notificationHistory));
                renderNotifications();
                showNotification('Semua notifikasi telah dihapus', 'success');
            }
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);

            if (minutes < 1) return 'Baru saja';
            if (minutes < 60) return `${minutes} menit yang lalu`;
            if (hours < 24) return `${hours} jam yang lalu`;
            if (days < 7) return `${days} hari yang lalu`;
            return date.toLocaleDateString('id-ID');
        }

        function renderWishlist() {
            const wishlistList = document.getElementById('wishlistList');
            if (!wishlistList) return;
            
            const wishlistEvents = eventsData.filter(e => wishlist.includes(e.id));

            if (wishlistEvents.length === 0) {
                wishlistList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-heart"></i>
                        <p>Belum ada event di wishlist</p>
                         <small class="text-muted">Tambahkan event ke wishlist dengan klik ikon hati</small>
                    </div>
                `;
                return;
            }

            wishlistList.innerHTML = `
                <div class="events-grid">
                    ${wishlistEvents.map(event => {
                        const isInWishlist = wishlist.includes(event.id);
                        return `
                            <div class="event-card" onclick="showEventDetailModal(${event.id})">
                                <div class="event-image-wrapper">
                                    <img src="${event.image}" alt="${event.title}" class="event-image" loading="lazy">
                                    <span class="event-badge">${event.category}</span>
                                    <button class="wishlist-btn ${isInWishlist ? 'active' : ''}" onclick="toggleWishlist(${event.id}, this); event.stopPropagation();">
                                        <i class="bi ${isInWishlist ? 'bi-heart-fill' : 'bi-heart'}"></i>
                                    </button>
                                </div>
                                <div class="event-content">
                                    <h6 class="event-title">${event.title}</h6>
                                    <div class="event-info">
                                        <div class="event-info-item">
                                            <i class="bi bi-calendar"></i>
                                            <span>${event.date.split(',')[0]}</span>
                                        </div>
                                        <div class="event-info-item">
                                            <i class="bi bi-geo-alt"></i>
                                            <span>${event.location.substring(0, 20)}${event.location.length > 20 ? '...' : ''}</span>
                                        </div>
                                    </div>
                                    <div class="event-footer">
                                        <div class="rating">
                                            <i class="bi bi-star-fill"></i>
                                            <span>${event.rating}</span>
                                        </div>
                                        <div class="event-price">${event.price}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderRegistered() {
            const registeredList = document.getElementById('registeredList');
             if (!registeredList) return;

            if (registeredEvents.length === 0) {
                registeredList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-ticket"></i>
                        <p>Belum ada event terdaftar</p>
                    </div>
                `;
                return;
            }

           registeredList.innerHTML = `
                <div class="events-grid">
                    ${registeredEvents.map(event => `
                        <div class="event-card" onclick="showEventDetailModal(${event.id})">
                            <div class="event-image-wrapper">
                                <img src="${event.image}" alt="${event.title}" class="event-image" loading="lazy">
                                <span class="event-badge registered">TERDAFTAR</span>
                            </div>
                            <div class="event-content">
                                <h6 class="event-title">${event.title}</h6>
                                <small class="text-muted">${event.date.split(',')[0]}</small>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            if (!historyList) return;

            if (eventHistory.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-clock-history"></i>
                        <p>Belum ada riwayat event</p>
                        <small class="text-muted">Event yang sudah selesai akan muncul di sini</small>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = eventHistory.map(event => `
                <div class="certificate-card">
                    <div class="d-flex gap-3">
                        <img src="${event.image}" alt="${event.title}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 10px;">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${event.title}</h6>
                            <small class="text-muted d-block mb-2"><i class="bi bi-calendar"></i> ${event.date}</small>
                            <small class="text-muted d-block mb-3"><i class="bi bi-geo-alt"></i> ${event.location}</small>
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="btn btn-sm btn-primary" onclick="viewCertificate(${event.id})">
                                    <i class="bi bi-award"></i> Lihat Sertifikat
                                </button>
                                <button class="btn btn-sm btn-success" onclick="downloadCertificate(${event.id})">
                                    <i class="bi bi-download"></i> Unduh
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="shareCertificate(${event.id})">
                                    <i class="bi bi-share"></i> Bagikan
                                </button>
                            </div>
                        </div>
                    </div>
                    ${!event.rated ? `
                        <div class="mt-3 p-3" style="background: #f8f9fa; border-radius: 10px;">
                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">Bagaimana pengalaman Anda?</small>
                                <button class="btn btn-sm btn-warning" onclick="rateEvent(${event.id})">
                                    <i class="bi bi-star"></i> Beri Rating
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div class="mt-2">
                            <small class="text-success"><i class="bi bi-check-circle-fill"></i> Anda memberi rating ${event.userRating} </small>
                        </div>
                    `}
                </div>
            `).join('');
        }

        function viewCertificate(eventId) {
            const event = eventHistory.find(e => e.id === eventId);
            if (!event) return;

            const certificateHTML = `
                <div style="background: white; padding: 40px; border: 10px solid var(--secondary); border-radius: 20px; text-align: center; max-width: 600px; margin: 20px auto;">
                    <h2 style="color: var(--primary); font-family: 'Poppins', serif; margin-bottom: 10px;">SERTIFIKAT</h2>
                    <p style="color: #666; margin-bottom: 30px;">Penghargaan Kehadiran</p>
                    <div style="margin: 30px 0;">
                        <p style="font-size: 14px; color: #666;">Diberikan kepada:</p>
                        <h3 style="color: var(--primary); font-size: 32px; margin: 10px 0;">${currentUser.name}</h3>
                    </div>
                    <div style="margin: 30px 0;">
                        <p style="font-size: 14px; color: #666;">Telah mengikuti:</p>
                        <h4 style="color: var(--primary); margin: 10px 0;">${event.title}</h4>
                        <p style="color: #666; font-size: 14px;">${event.date}</p>
                        <p style="color: #666; font-size: 14px;">${event.location}</p>
                    </div>
                    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee;">
                        <p style="font-size: 14px; color: #666;">Diselenggarakan oleh:</p>
                        <p style="font-weight: 600; color: var(--primary);">${event.organizer}</p>
                    </div>
                    <div style="margin-top: 30px;">
                        <p style="font-size: 12px; color: #999;">Nomor Sertifikat: ${event.id}-${currentUser.id}-${Date.now()}</p>
                    </div>
                </div>
            `;

            const modalDiv = document.createElement('div');
            modalDiv.innerHTML = `
                <div class="modal fade show" style="display: block; background: rgba(0,0,0,0.8);" onclick="this.remove()">
                    <div class="modal-dialog modal-lg modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header" style="background: var(--primary); color: white;">
                                <h5 class="modal-title">Sertifikat ${event.title}</h5>
                                <button type="button" class="btn-close btn-close-white" onclick="this.closest('.modal').remove()"></button>
                            </div>
                            <div class="modal-body">
                                ${certificateHTML}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Tutup</button>
                                <button class="btn btn-success" onclick="downloadCertificate(${event.id})">
                                    <i class="bi bi-download"></i> Unduh Sertifikat
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);
        }

        function downloadCertificate(eventId) {
            const event = eventHistory.find(e => e.id === eventId) || eventsData.find(e => e.id === eventId);
            if (!event) return;
            
            showNotification(` Sertifikat "${event.title}" sedang diunduh...`);
            
            setTimeout(() => {
                showNotification(` Sertifikat berhasil diunduh!`);
            }, 1500);
        }

        function shareCertificate(eventId) {
            const event = eventHistory.find(e => e.id === eventId);
            if (!event) return;

            const shareText = ` Saya telah menyelesaikan "${event.title}" di Eventraze!\n\nCek event menarik lainnya di Eventraze.`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Sertifikat ${event.title}`,
                    text: shareText,
                    url: window.location.href
                }).catch(() => {
                    copyToClipboard(shareText);
                });
            } else {
                copyToClipboard(shareText);
            }
        }

        function rateEvent(eventId) {
            const event = eventHistory.find(e => e.id === eventId);
            if (!event) return;

            const ratingHTML = `
                <div class="text-center">
                    <h5 class="mb-3">Bagaimana pengalaman Anda?</h5>
                    <p class="text-muted mb-4">${event.title}</p>
                    <div class="mb-4">
                        <div class="rating-stars" style="font-size: 48px; cursor: pointer;">
                            <i class="bi bi-star" data-rating="1" onclick="selectRating(1)"></i>
                            <i class="bi bi-star" data-rating="2" onclick="selectRating(2)"></i>
                            <i class="bi bi-star" data-rating="3" onclick="selectRating(3)"></i>
                            <i class="bi bi-star" data-rating="4" onclick="selectRating(4)"></i>
                            <i class="bi bi-star" data-rating="5" onclick="selectRating(5)"></i>
                        </div>
                        <p id="ratingText" class="mt-2 text-muted">Pilih rating Anda</p>
                    </div>
                    <textarea id="ratingComment" class="form-control mb-3" rows="3" placeholder="Tulis komentar Anda (opsional)"></textarea>
                    <button class="btn btn-primary w-100" onclick="submitRating(${eventId})">Kirim Rating</button>
                </div>
            `;

            const modalDiv = document.createElement('div');
            modalDiv.id = 'ratingModal';
            modalDiv.innerHTML = `
                <div class="modal fade show" style="display: block; background: rgba(0,0,0,0.5);">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Beri Rating</h5>
                                <button type="button" class="btn-close" onclick="document.getElementById('ratingModal').remove()"></button>
                            </div>
                            <div class="modal-body">
                                ${ratingHTML}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modalDiv);

            window.selectRating = function(rating) {
                const stars = document.querySelectorAll('.rating-stars i');
                const texts = ['Sangat Buruk', 'Buruk', 'Cukup', 'Bagus', 'Sangat Bagus'];
                
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.className = 'bi bi-star-fill';
                        star.style.color = '#ffd700';
                    } else {
                        star.className = 'bi bi-star';
                        star.style.color = '#ddd';
                    }
                });
                
                document.getElementById('ratingText').textContent = texts[rating - 1];
                window.selectedRating = rating;
            };

            window.submitRating = function(eventId) {
                if (!window.selectedRating) {
                    alert('Silakan pilih rating terlebih dahulu!');
                    return;
                }

                const comment = document.getElementById('ratingComment').value;
                const eventIndex = eventHistory.findIndex(e => e.id === eventId);
                
                if (eventIndex > -1) {
                    eventHistory[eventIndex].rated = true;
                    eventHistory[eventIndex].userRating = window.selectedRating;
                    eventHistory[eventIndex].userComment = comment;
                    localStorage.setItem(`history_${currentUser.id}`, JSON.stringify(eventHistory));
                }

                showNotification(` Terima kasih atas rating ${window.selectedRating} bintang!`);
                document.getElementById('ratingModal').remove();
                renderHistory();
            };
        }

        function addDemoHistory() {
            if (eventHistory.length === 0 && registeredEvents.length > 0) {
                const demoHistory = [
                    {
                        ...eventsData[0],
                        completedAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                        rated: false
                    }
                ];
                eventHistory.push(...demoHistory);
                localStorage.setItem(`history_${currentUser.id}`, JSON.stringify(eventHistory));
            }
        }

        // ============================
        // PROFILE FUNCTIONS
        // ============================
        function updateProfileDisplay() {
            if (!currentUser) return;
            
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileEmail').textContent = currentUser.email;
            document.getElementById('avatarInitial').textContent = currentUser.name.charAt(0).toUpperCase();
            document.getElementById('editAvatarInitial').textContent = currentUser.name.charAt(0).toUpperCase();

            if (currentUser.avatar) {
                document.getElementById('profileAvatar').style.backgroundImage = `url(${currentUser.avatar})`;
                document.getElementById('profileAvatar').style.backgroundSize = 'cover';
                document.getElementById('avatarInitial').style.display = 'none';
                document.getElementById('editAvatarPreview').style.backgroundImage = `url(${currentUser.avatar})`;
                document.getElementById('editAvatarPreview').style.backgroundSize = 'cover';
                document.getElementById('editAvatarInitial').style.display = 'none';
            }
        }

        function showEditProfile() {
            if (!currentUser) return;
            
            document.getElementById('editName').value = currentUser.name;
            document.getElementById('editEmail').value = currentUser.email;
            
            const modal = new bootstrap.Modal(document.getElementById('editProfileModal'));
            modal.show();
        }

        document.getElementById('editProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const newName = document.getElementById('editName').value;
            const newEmail = document.getElementById('editEmail').value;

            currentUser.name = newName;
            currentUser.email = newEmail;

            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex > -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('users', JSON.stringify(users));
            }

            const session = JSON.parse(localStorage.getItem('session'));
            session.name = newName;
            session.email = newEmail;
            localStorage.setItem('session', JSON.stringify(session));

            updateProfileDisplay();
            document.getElementById('greetingText').textContent = `Halo, ${newName}!`;

            bootstrap.Modal.getInstance(document.getElementById('editProfileModal')).hide();
            alert('Profil berhasil diperbarui!');
        });

        document.getElementById('avatarInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentUser.avatar = e.target.result;
                    
                    let users = JSON.parse(localStorage.getItem('users') || '[]');
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex > -1) {
                        users[userIndex].avatar = currentUser.avatar;
                        localStorage.setItem('users', JSON.stringify(users));
                    }

                    const session = JSON.parse(localStorage.getItem('session'));
                    session.avatar = currentUser.avatar;
                    localStorage.setItem('session', JSON.stringify(session));

                    updateProfileDisplay();
                };
                reader.readAsDataURL(file);
            }
        });

        function showCertificates() {
            const certificatesList = document.getElementById('certificatesList');
            
            if (eventHistory.length === 0) {
                certificatesList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-award"></i>
                        <p>Belum ada sertifikat</p>
                        <small class="text-muted">Ikuti event untuk mendapatkan sertifikat</small>
                    </div>
                `;
            } else {
                certificatesList.innerHTML = eventHistory.map(event => `
                    <div class="certificate-card">
                        <h6>${event.title}</h6>
                        <p class="text-muted mb-2">${event.date}</p>
                        <button class="btn btn-sm btn-primary" onclick="downloadCertificate(${event.id})">
                            <i class="bi bi-download"></i> Unduh Sertifikat
                        </button>
                    </div>
                `).join('');
            }

            const modal = new bootstrap.Modal(document.getElementById('certificatesModal'));
            modal.show();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            document.getElementById('darkModeToggle').classList.toggle('active');

            const settings = JSON.parse(localStorage.getItem(`settings_${currentUser.id}`) || '{}');
            settings.darkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem(`settings_${currentUser.id}`, JSON.stringify(settings));

            anime({
                targets: '#darkModeToggle .toggle-slider',
                translateX: settings.darkMode ? 24 : 0,
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        function toggleNotifications() {
            notificationsEnabled = !notificationsEnabled;
            document.getElementById('notifToggle').classList.toggle('active');

            const settings = JSON.parse(localStorage.getItem(`settings_${currentUser.id}`) || '{}');
            settings.notifications = notificationsEnabled;
            localStorage.setItem(`settings_${currentUser.id}`, JSON.stringify(settings));

            if (notificationsEnabled) {
                showNotification('Notifikasi diaktifkan!');
            }

            anime({
                targets: '#notifToggle .toggle-slider',
                translateX: notificationsEnabled ? 24 : 0,
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        function showHelp() {
            const modal = new bootstrap.Modal(document.getElementById('helpModal'));
            modal.show();
        }

        function logout() {
            if (confirm('Yakin ingin keluar?')) {
                localStorage.removeItem('session');
                currentUser = null;
                wishlist = [];
                registeredEvents = [];
                eventHistory = [];
                showPage('loginPage');
            }
        }

        function showNotification(message, type = 'info') {
            const notifData = {
                message,
                type,
                timestamp: new Date().toISOString()
            };
            
            notificationHistory.push(notifData);
            localStorage.setItem(`notifications_${currentUser.id}`, JSON.stringify(notificationHistory.slice(-50)));
            
            if (document.getElementById('notifikasiTab').style.display === 'block') {
                renderNotifications();
            }

            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            const icons = {
                success: '',
                info: '',
                warning: '',
                error: '',
                reminder: '',
                event: ''
            };

            toast.innerHTML = `
                <span style="font-size: 20px;">${icons[type] || icons.info}</span>
                <span style="flex: 1;">${message}</span>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: var(--primary); font-size: 20px; cursor: pointer; padding: 0; margin-left: 10px;">&times;</button>
            `;
            
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function initNotifications() {
            if (!currentUser) return;

            notificationHistory = JSON.parse(localStorage.getItem(`notifications_${currentUser.id}`) || '[]');

            // Check for event reminders every 30 minutes
            setInterval(checkEventReminders, 30 * 60 * 1000);
            
            // Send recommendations every hour
            setInterval(sendEventRecommendations, 60 * 60 * 1000);

            checkEventReminders();
        }

        function checkEventReminders() {
            if (!notificationsEnabled) return;

            const now = new Date();
            
            registeredEvents.forEach(event => {
                const eventDate = new Date(event.date);
                const timeDiff = eventDate - now;
                const hoursDiff = timeDiff / (1000 * 60 * 60);

                if (hoursDiff > 0 && hoursDiff <= 24) {
                    const hours = Math.floor(hoursDiff);
                    showNotification(
                        `Pengingat: ${event.title} akan dimulai dalam ${hours} jam!`,
                        'reminder'
                    );
                }
            });
        }

        function sendEventRecommendations() {
            if (!notificationsEnabled) return;

            const unseenEvents = eventsData.filter(e => 
                !registeredEvents.some(r => r.id === e.id) &&
                !wishlist.includes(e.id)
            );

            if (unseenEvents.length > 0) {
                const randomEvent = unseenEvents[Math.floor(Math.random() * unseenEvents.length)];
                showNotification(
                    `Event baru: ${randomEvent.title} - ${randomEvent.price}`,
                    'event'
                );
            }
        }

        function sendWelcomeNotification() {
            if (!notificationsEnabled) return;

            const hour = new Date().getHours();
            let greeting = 'Selamat datang';
            
            if (hour < 12) greeting = 'Selamat pagi';
            else if (hour < 18) greeting = 'Selamat siang';
            else greeting = 'Selamat malam';

            setTimeout(() => {
                showNotification(`${greeting}, ${currentUser.name}! `, 'success');
                
                setTimeout(() => {
                    showNotification(`Ada ${eventsData.length} event menanti Anda!`, 'info');
                }, 2000);
            }, 1000);
        }

        // Toggle FAQ Item
        function toggleFAQ(element) {
            element.classList.toggle('active');
            
            anime({
                targets: element.querySelector('.faq-icon'),
                rotate: element.classList.contains('active') ? 180 : 0,
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        // Fungsi untuk update semua tampilan wishlist
        function updateWishlistDisplay() {
            // Update halaman home jika sedang aktif
            if (document.getElementById('homePage').classList.contains('active')) {
                renderEvents(currentFilter);
            }
            
            // Update halaman wishlist jika sedang aktif
            if (document.getElementById('wishlistTab').style.display === 'block') {
                renderWishlist();
            }
        }

        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(() => console.log('SW registered!'))
                .catch(err => console.log('SW gagal:', err));
        }

        // PWA Manifest
        const manifest = {
            name: 'Eventraze',
            short_name: 'Eventraze',
            description: 'Temukan event menarik di sekitar Indonesia',
            start_url: '/',
            display: 'standalone',
            background_color: '#0F0F0F',
            theme_color: '#0F0F0F',
            orientation: 'portrait',
            icons: [
                {
                    src: 'icons/logoeventraze192x192.png',
                    sizes: '192x192',
                    type: 'image/png'
                },
                {
                    src: 'icons/logoeventraze512x512.png',
                    sizes: '512x512',
                    type: 'image/png'
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);

        // Initialize App
        checkAuth();

        // Animate megaphone on load
        anime({
            targets: '.megaphone',
            rotate: [-15, 15],
            duration: 2000,
            easing: 'easeInOutQuad',
            loop: true,
            direction: 'alternate'
        });
    </script>
</body>
</html>